/*
@license textAngular
Author : Austin Anderson
License : 2013 MIT
Version 1.3.11
See README.md or https://github.com/fraywing/textAngular/wiki for requirements and use.
*/
(function(){"use strict";function w(n){try{return angular.element(n).length!==0}catch(t){return!1}}function b(n,t){if(!n||n===""||e.hasOwnProperty(n))throw"textAngular Error: A unique name is required for a Tool Definition";if(t.display&&(t.display===""||!w(t.display))||!t.display&&!t.buttontext&&!t.iconclass)throw'textAngular Error: Tool Definition for "'+n+'" does not have a valid display/iconclass/buttontext value';e[n]=t}var n={ie:function(){for(var i,n=3,t=document.createElement("div"),r=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++n+"]><i><\/i><![endif]-->",r[0];);return n>4?n:i}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)},o=!1,i,c,l,a,v,y,u,r;n.webkit&&(document.addEventListener("mousedown",function(n){var u=n||window.event,i=u.target,r,t;if(o&&i!==null){for(r=!1,t=i;t!==null&&t.tagName.toLowerCase()!=="html"&&!r;)r=t.contentEditable==="true",t=t.parentNode;r||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),i.focus(),i.select&&i.select())}o=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" class="ta-hidden-input" unselectable="on" tabIndex="-1">'))}));var t=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,p=/^(ul|li|ol)$/i,s=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;if(String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),n.ie>8||n.ie===undefined){for(u=document.styleSheets,r=0;r<u.length;r++)if((u[r].media.length===0||u[r].media.mediaText.match(/(all|screen)/ig))&&u[r].href&&u[r].href.match(/textangular\.(min\.|)css/ig)){i=u[r];break}i||(i=function(){var t=document.createElement("style");return n.webkit&&t.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(t),t.sheet}());c=function(n,t){return a(i,n,t)};a=function(n,t,r){var u,f;return n.cssRules?u=Math.max(n.cssRules.length-1,0):n.rules&&(u=Math.max(n.rules.length-1,0)),n.insertRule?n.insertRule(t+"{"+r+"}",u):n.addRule(t,r,u),i.rules?f=i.rules[u]:i.cssRules&&(f=i.cssRules[u]),f};y=function(n,t){for(var r,i=0;i<t.length;i++)if(t[i].cssText===n.cssText){r=i;break}return r};l=function(n){v(i,n)};v=function(n,t){var i=y(t,n.cssRules||n.rules);n.removeRule?n.removeRule(i):n.deleteRule(i)}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(t){return t?t===""?n.ie===undefined?"div":n.ie<=8?"P":"p":n.ie<=8?t.toUpperCase():t:n.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(n,t){return function(i){var r=angular.element("<div><\/div>");return r[0].innerHTML=i,angular.forEach(n,function(n){var i=[];n.selector&&n.selector!==""?i=r.find(n.selector):n.customAttribute&&n.customAttribute!==""&&(i=t.getByAttribute(r,n.customAttribute));angular.forEach(i,function(t){t=angular.element(t);n.selector&&n.selector!==""&&n.customAttribute&&n.customAttribute!==""?t.attr(n.customAttribute)!==undefined&&n.renderLogic(t):n.renderLogic(t)})}),r[0].innerHTML}}]).factory("taFixChrome",function(){return function(n){if(!n||!angular.isString(n)||n.length<=0)return n;for(var e=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/ig,t,i,r,f="",u=0;t=e.exec(n);)i=t[3]||t[4],i&&i.match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(i=i.replace(/( |)font-family: inherit;|( |)line-height: 1.428571429;|( |)line-height:1.1;|( |)color: inherit;/ig,""),r="<"+t[1].trim(),i.length>0&&(r+=" style="+t[2].substring(0,1)+i+t[2].substring(0,1)),r+=t[5].trim()+">",f+=n.substring(u,t.index)+r,u=t.index+t[0].length);return f+=n.substring(u),u>0?f.replace(/<span\s*>(.*?)<\/span>(<br(\/|)>|)/ig,"$1"):n}}).factory("taSanitize",["$sanitize",function(n){function o(n,t){for(var i=0,r=0,u,f=/<[^>]*>/ig;u=f.exec(n);)if(r=u.index,u[0].substr(1,1)==="/")if(i===0)break;else i--;else i++;return t+n.substring(0,r)+angular.element(t)[0].outerHTML.substring(t.length)+n.substring(r)}function s(n){var y,p;if(!n||!angular.isString(n)||n.length<=0)return n;for(var u,w=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/ig,i,v,r,l,e="",a,h="",c=0;i=w.exec(n);)if(r=i[3]||i[4],y=new RegExp(f,"i"),angular.isString(r)&&y.test(r)){for(l="",p=new RegExp(f,"ig");v=p.exec(r);)for(u=0;u<t.length;u++)!v[u*2+2]||(l+="<"+t[u].tag+">");a=s(n.substring(c,i.index));h+=e.length>0?o(a,e):a;r=r.replace(new RegExp(f,"ig"),"");h+="<"+i[1].trim();r.length>0&&(h+=' style="'+r+'"');h+=i[5]+">";c=i.index+i[0].length;e=l}return h+(e.length>0?o(n.substring(c),e):n.substring(c))}function h(n){var i;if(!n||!angular.isString(n)||n.length<=0)return n;for(var f=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/ig,t,r="",u=0;t=f.exec(n);)r+=n.substring(u,t.index),u=t.index+t[0].length,i="<"+t[1]+t[5],/style=("([^"]+)"|'([^']+)')/ig.test(i)?i=i.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):i+=' style="text-align:'+(t[3]||t[4])+';"',i+=">",r+=i;return r+n.substring(u)}for(var r,u,f,t=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],e=[],i=0;i<t.length;i++){for(r="("+t[i].property+":\\s*(",u=0;u<t[i].values.length;u++)u>0&&(r+="|"),r+=t[i].values[u];r+=");)";e.push(r)}return f="("+e.join("|")+")",function(t,i,r){var u;if(!r)try{t=s(t)}catch(v){}t=h(t);try{u=n(t);r&&(u=t)}catch(v){u=i||""}var l=u.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/ig),e=u.replace(/(&#(9|10);)*/ig,""),a=/<pre[^>]*>.*?<\/pre[^>]*>/ig,o=0,c=0,f;for(u="";(f=a.exec(e))!==null&&o<l.length;)u+=e.substring(c,f.index)+l[o],c=f.index+f[0].length,o++;return u+e.substring(c)}}]).factory("taToolExecuteAction",["$q","$log",function(n,t){return function(i){i!==undefined&&(this.$editor=function(){return i});var r=n.defer(),e=r.promise,u=this.$editor(),f;try{f=this.action(r,u.startAction());e["finally"](function(){u.endAction.call(u)})}catch(o){t.error(o)}(f||f===undefined)&&r.resolve()}}]);angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(n,i,r){var u=function(t,i){for(var u,f=t.find("li"),r=f.length-1;r>=0;r--)u=angular.element("<"+i+">"+f[r].innerHTML+"<\/"+i+">"),t.after(u);t.remove();n.setSelectionToElementEnd(u[0])},e=function(t){/(<br(|\/)>)$/i.test(t.innerHTML.trim())?n.setSelectionBeforeElement(angular.element(t).find("br")[0]):n.setSelectionToElementEnd(t)},f=function(n,t){var i=angular.element("<"+t+">"+n[0].innerHTML+"<\/"+t+">");n.after(i);n.remove();e(i.find("li")[0])},o=function(n,t,r){for(var f,o="",u=0;u<n.length;u++)o+="<"+i("li")+">"+n[u].innerHTML+"<\/"+i("li")+">";f=angular.element("<"+r+">"+o+"<\/"+r+">");t.after(f);t.remove();e(f.find("li")[0])};return function(e,s){return e=i(e),function(h,c,l){var a,y,d,v,st,g,nt,tt=angular.element("<"+e+">"),w,k,b,ot,ft,ut,et,it,rt,ht;try{nt=n.getSelectionElement()}catch(ct){}if(w=angular.element(nt),nt!==undefined)if(k=nt.tagName.toLowerCase(),h.toLowerCase()==="insertorderedlist"||h.toLowerCase()==="insertunorderedlist"){if(b=i(h.toLowerCase()==="insertorderedlist"?"ol":"ul"),k===b)return u(w,e);if(k==="li"&&w.parent()[0].tagName.toLowerCase()===b&&w.parent().children().length===1)return u(w.parent(),e);if(k==="li"&&w.parent()[0].tagName.toLowerCase()!==b&&w.parent().children().length===1)return f(w.parent(),b);if(k.match(t)&&!w.hasClass("ta-bind"))return k==="ol"||k==="ul"?f(w,b):(ot=!1,angular.forEach(w.children(),function(n){n.tagName.match(t)&&(ot=!0)}),ot?o(w.children(),w,b):o([angular.element("<div>"+nt.innerHTML+"<\/div>")[0]],w,b));if(k.match(t)){if(v=n.getOnlySelectedElements(),v.length===0)y=angular.element("<"+b+"><li>"+nt.innerHTML+"<\/li><\/"+b+">"),w.html(""),w.append(y);else{if(v.length===1&&(v[0].tagName.toLowerCase()==="ol"||v[0].tagName.toLowerCase()==="ul"))return v[0].tagName.toLowerCase()===b?u(angular.element(v[0]),e):f(angular.element(v[0]),b);for(d="",ft=[],a=0;a<v.length;a++)if(v[a].nodeType!==3){if(ut=angular.element(v[a]),v[a].tagName.toLowerCase()==="li")continue;else d+=v[a].tagName.toLowerCase()==="ol"||v[a].tagName.toLowerCase()==="ul"?ut[0].innerHTML:v[a].tagName.toLowerCase()==="span"&&(v[a].childNodes[0].tagName.toLowerCase()==="ol"||v[a].childNodes[0].tagName.toLowerCase()==="ul")?ut[0].childNodes[0].innerHTML:"<"+i("li")+">"+ut[0].innerHTML+"<\/"+i("li")+">";ft.unshift(ut)}y=angular.element("<"+b+">"+d+"<\/"+b+">");ft.pop().replaceWith(y);angular.forEach(ft,function(n){n.remove()})}n.setSelectionToElementEnd(y[0]);return}}else{if(h.toLowerCase()==="formatblock"){for(g=l.toLowerCase().replace(/[<>]/ig,""),g.trim()==="default"&&(g=e,l="<"+e+">"),y=k==="li"?w.parent():w;!y[0].tagName||!y[0].tagName.match(t)&&!y.parent().attr("contenteditable");)y=y.parent(),k=(y[0].tagName||"").toLowerCase();if(k===g){for(v=y.children(),et=!1,a=0;a<v.length;a++)et=et||v[a].tagName.match(t);et?(y.after(v),st=y.next(),y.remove(),y=st):(tt.append(y[0].childNodes),y.after(tt),y.remove(),y=tt)}else if(y.parent()[0].tagName.toLowerCase()!==g||y.parent().hasClass("ta-bind"))if(k.match(p))y.wrap(l);else{for(v=n.getOnlySelectedElements(),v.length===0&&(v=[y[0]]),a=0;a<v.length;a++)if(v[a].nodeType===3||!v[a].tagName.match(t))while(v[a].nodeType===3||!v[a].tagName||!v[a].tagName.match(t))v[a]=v[a].parentNode;if(angular.element(v[0]).hasClass("ta-bind"))y=angular.element(l),y[0].innerHTML=v[0].innerHTML,v[0].innerHTML=y[0].outerHTML;else if(g==="blockquote"){for(d="",a=0;a<v.length;a++)d+=v[a].outerHTML;for(y=angular.element(l),y[0].innerHTML=d,v[0].parentNode.insertBefore(y[0],v[0]),a=v.length-1;a>=0;a--)v[a].parentNode&&v[a].parentNode.removeChild(v[a])}else for(a=0;a<v.length;a++)y=angular.element(l),y[0].innerHTML=v[a].innerHTML,v[a].parentNode.insertBefore(y[0],v[a]),v[a].parentNode.removeChild(v[a])}else{for(it=y.parent(),rt=it.contents(),a=0;a<rt.length;a++)it.parent().hasClass("ta-bind")&&rt[a].nodeType===3&&(tt=angular.element("<"+e+">"),tt[0].innerHTML=rt[a].outerHTML,rt[a]=tt[0]),it.parent()[0].insertBefore(rt[a],it[0]);it.remove()}n.setSelectionToElementEnd(y[0]);return}if(h.toLowerCase()==="createlink"){if(ht=n.getSelection(),ht.collapsed){n.insertHtml('<a href="'+l+'">'+l+"<\/a>",s);return}}else if(h.toLowerCase()==="inserthtml"){n.insertHtml(l,s);return}}try{r[0].execCommand(h,c,l)}catch(ct){}}}}]).service("taSelection",["$window","$document","taDOM",function(n,i,r){var f=i[0],u=n.rangy,o=function(n,t){return n.tagName&&n.tagName.match(/^br$/i)&&t===0&&!n.previousSibling?{element:n.parentNode,offset:0}:{element:n,offset:t}},e={getSelection:function(){var t=u.getSelection().getRangeAt(0),n=t.commonAncestorContainer,i={start:o(t.startContainer,t.startOffset),end:o(t.endContainer,t.endOffset),collapsed:t.collapsed};return n=n.nodeType===3?n.parentNode:n,i.container=n.parentNode===i.start.element||n.parentNode===i.end.element?n.parentNode:n,i},getOnlySelectedElements:function(){var t=u.getSelection().getRangeAt(0),n=t.commonAncestorContainer;return n=n.nodeType===3?n.parentNode:n,t.getNodes([1],function(t){return t.parentNode===n})},getSelectionElement:function(){return e.getSelection().container},setSelection:function(n,t,i){var r=u.createRange();r.setStart(n,t);r.setEnd(n,i);u.getSelection().setSingleRange(r)},setSelectionBeforeElement:function(n){var t=u.createRange();t.selectNode(n);t.collapse(!0);u.getSelection().setSingleRange(t)},setSelectionAfterElement:function(n){var t=u.createRange();t.selectNode(n);t.collapse(!1);u.getSelection().setSingleRange(t)},setSelectionToElementStart:function(n){var t=u.createRange();t.selectNodeContents(n);t.collapse(!0);u.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(n){var t=u.createRange();t.selectNodeContents(n);t.collapse(!1);n.childNodes&&n.childNodes[n.childNodes.length-1]&&n.childNodes[n.childNodes.length-1].nodeName==="br"&&(t.startOffset=t.endOffset=t.startOffset-1);u.getSelection().setSingleRange(t)},insertHtml:function(n,i){var o,c,l,k,p,a,g,w=angular.element("<div>"+n+"<\/div>"),h=u.getSelection().getRangeAt(0),v=f.createDocumentFragment(),y=w[0].childNodes,b=!0,d,nt;if(y.length>0){for(k=[],l=0;l<y.length;l++)y[l].nodeName.toLowerCase()==="p"&&y[l].innerHTML.trim()===""||y[l].nodeType===3&&y[l].nodeValue.trim()===""||(b=b&&!t.test(y[l].nodeName),k.push(y[l]));for(d=0;d<k.length;d++)a=v.appendChild(k[d]);!b&&h.collapsed&&/^(|<br(|\/)>)$/i.test(h.startContainer.innerHTML)&&h.selectNode(h.startContainer)}else b=!0,a=v=f.createTextNode(n);if(b)h.deleteContents();else if(h.collapsed&&h.startContainer!==i)if(h.startContainer.innerHTML&&h.startContainer.innerHTML.match(/^<[^>]*>$/i))o=h.startContainer,h.startOffset===1?(h.setStartAfter(o),h.setEndAfter(o)):(h.setStartBefore(o),h.setEndBefore(o));else{if(h.startContainer.nodeType===3&&h.startContainer.parentNode!==i)for(o=h.startContainer.parentNode,c=o.cloneNode(),r.splitNodes(o.childNodes,o,c,h.startContainer,h.startOffset);!s.test(o.nodeName);)angular.element(o).after(c),o=o.parentNode,nt=c,c=o.cloneNode(),r.splitNodes(o.childNodes,o,c,nt);else o=h.startContainer,c=o.cloneNode(),r.splitNodes(o.childNodes,o,c,undefined,undefined,h.startOffset);if(angular.element(o).after(c),h.setStartAfter(o),h.setEndAfter(o),/^(|<br(|\/)>)$/i.test(o.innerHTML.trim())&&(h.setStartBefore(o),h.setEndBefore(o),angular.element(o).remove()),/^(|<br(|\/)>)$/i.test(c.innerHTML.trim())&&angular.element(c).remove(),o.nodeName.toLowerCase()==="li"){for(g=f.createDocumentFragment(),p=0;p<v.childNodes.length;p++)w=angular.element("<li>"),r.transferChildNodes(v.childNodes[p],w[0]),r.transferNodeAttributes(v.childNodes[p],w[0]),g.appendChild(w[0]);v=g;a&&(a=v.childNodes[v.childNodes.length-1],a=a.childNodes[a.childNodes.length-1])}}else h.deleteContents();h.insertNode(v);a&&e.setSelectionToElementEnd(a)}};return e}]).service("taDOM",function(){var n={getByAttribute:function(t,i){var r=[],u=t.children();return u.length&&angular.forEach(u,function(t){r=r.concat(n.getByAttribute(angular.element(t),i))}),t.attr(i)!==undefined&&r.push(t),r},transferChildNodes:function(n,t){for(t.innerHTML="";n.childNodes.length>0;)t.appendChild(n.childNodes[0]);return t},splitNodes:function(t,i,r,u,f,e){if(!u&&isNaN(e))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var o=document.createDocumentFragment(),s=document.createDocumentFragment(),h=0;t.length>0&&(isNaN(e)||e!==h)&&t[0]!==u;)o.appendChild(t[0]),h++;for(!isNaN(f)&&f>=0&&t[0]&&(o.appendChild(document.createTextNode(t[0].nodeValue.substring(0,f))),t[0].nodeValue=t[0].nodeValue.substring(f));t.length>0;)s.appendChild(t[0]);n.transferChildNodes(o,i);n.transferChildNodes(s,r)},transferNodeAttributes:function(n,t){for(var i=0;i<n.attributes.length;i++)t.setAttribute(n.attributes[i].name,n.attributes[i].value);return t}};return n});angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){function f(n){var t=angular.element("<div/>"),i;return t.html(n),i=t.text().length,i<=u?(r.$setValidity("taMaxText",!0),n):(r.$setValidity("taMaxText",!1),undefined)}var u=parseInt(n.$eval(i.taMaxText));if(isNaN(u))throw"Max text must be an integer";i.$observe("taMaxText",function(n){if(u=parseInt(n),isNaN(u))throw"Max text must be an integer";r.$dirty&&r.$setViewValue(r.$viewValue)});r.$parsers.unshift(f)}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){function f(n){var i=angular.element("<div/>"),t;return i.html(n),t=i.text().length,!t||t>=u?(r.$setValidity("taMinText",!0),n):(r.$setValidity("taMinText",!1),undefined)}var u=parseInt(n.$eval(i.taMinText));if(isNaN(u))throw"Min text must be an integer";i.$observe("taMinText",function(n){if(u=parseInt(n),isNaN(u))throw"Min text must be an integer";r.$dirty&&r.$setViewValue(r.$viewValue)});r.$parsers.unshift(f)}}});angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var n=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(t){return function(i){if(!i)return!0;var u=/(^[^<]|>)[^<]/i.exec(i),r;return(u?r=u.index:(i=i.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,""),r=i.indexOf(">")),i=i.trim().substring(r,r+100),/^[^<>]+$/i.test(i))?!1:i.length===0||i===t||/^>(\s|&nbsp;)*<\/[^>]+>$/ig.test(i)?!0:/>\s*[^\s<]/i.test(i)||n.test(i)?!1:!0}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM",function(i,r,u,f,e,a,v,y,p,w,b,k,d){return{require:"ngModel",link:function(a,g,nt,tt){var rt=g.attr("contenteditable")!==undefined&&g.attr("contenteditable"),ii=rt||g[0].tagName.toLowerCase()==="textarea"||g[0].tagName.toLowerCase()==="input",it=!1,at=!1,vt=!1,ri=nt.taUnsafeSanitizer||w.disableSanitizer,ui,oi=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,si=/^(8|13|32|46|59|61|107|109|186|187|188|189|190|191|192|219|220|221|222)$/i,wt,ut,bt,yt,kt,st,dt,gt,pt,ni,ht,ti,fi;nt.taDefaultWrap===undefined&&(nt.taDefaultWrap="p");nt.taDefaultWrap===""?(ut="",bt=n.ie===undefined?"<div><br><\/div>":n.ie>=11?"<p><br><\/p>":n.ie<=8?"<P>&nbsp;<\/P>":"<p>&nbsp;<\/p>"):(ut=n.ie===undefined||n.ie>=11?"<"+nt.taDefaultWrap+"><br><\/"+nt.taDefaultWrap+">":n.ie<=8?"<"+nt.taDefaultWrap.toUpperCase()+"><\/"+nt.taDefaultWrap.toUpperCase()+">":"<"+nt.taDefaultWrap+"><\/"+nt.taDefaultWrap+">",bt=n.ie===undefined||n.ie>=11?"<"+nt.taDefaultWrap+"><br><\/"+nt.taDefaultWrap+">":n.ie<=8?"<"+nt.taDefaultWrap.toUpperCase()+">&nbsp;<\/"+nt.taDefaultWrap.toUpperCase()+">":"<"+nt.taDefaultWrap+">&nbsp;<\/"+nt.taDefaultWrap+">");yt=b(bt);kt=function(n){var f,r,i,e,u;if(yt(n))return n;if(f=angular.element("<div>"+n+"<\/div>"),f.children().length===0)n="<"+nt.taDefaultWrap+">"+n+"<\/"+nt.taDefaultWrap+">";else{for(r=f[0].childNodes,e=!1,i=0;i<r.length;i++)if(e=r[i].nodeName.toLowerCase().match(t))break;if(e)for(n="",i=0;i<r.length;i++)r[i].nodeName.toLowerCase().match(t)?n+=r[i].outerHTML:(u=r[i].outerHTML||r[i].nodeValue,n+=u.trim()!==""?"<"+nt.taDefaultWrap+">"+u+"<\/"+nt.taDefaultWrap+">":u);else n="<"+nt.taDefaultWrap+">"+n+"<\/"+nt.taDefaultWrap+">"}return n};nt.taPaste&&(wt=k(nt.taPaste));g.addClass("ta-bind");a["$undoManager"+(nt.id||"")]=tt.$undoManager={_stack:[],_index:0,_max:1e3,push:function(n){return typeof n=="undefined"||n===null||typeof this.current()!="undefined"&&this.current()!==null&&n===this.current()?n:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(n),st&&r.cancel(st),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,n)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(n){return n<0||n>this._stack.length-1?undefined:(this._index=n,this.current())},current:function(){return this._stack[this._index]}};var hi=a["$undoTaBind"+(nt.id||"")]=function(){if(!it&&rt){var n=tt.$undoManager.undo();typeof n!="undefined"&&n!==null&&(ft(n),ot(n,!1),g[0].childNodes.length?v.setSelectionToElementEnd(g[0].childNodes[g[0].childNodes.length-1]):v.setSelectionToElementEnd(g[0]))}},ci=a["$redoTaBind"+(nt.id||"")]=function(){if(!it&&rt){var n=tt.$undoManager.redo();typeof n!="undefined"&&n!==null&&(ft(n),ot(n,!1),g[0].childNodes.length?v.setSelectionToElementEnd(g[0].childNodes[g[0].childNodes.length-1]):v.setSelectionToElementEnd(g[0]))}},et=function(){if(rt)return g[0].innerHTML;if(ii)return g.val();throw"textAngular Error: attempting to update non-editable taBind";},ot=function(n,t){vt=!0;(typeof t=="undefined"||t===null)&&(t=!0&&rt);(typeof n=="undefined"||n===null)&&(n=et());yt(n)?(tt.$viewValue!==""&&tt.$setViewValue(""),t&&tt.$undoManager.current()!==""&&tt.$undoManager.push("")):(ei(),tt.$viewValue!==n&&(tt.$setViewValue(n),t&&tt.$undoManager.push(n)))};if(a["updateTaBind"+(nt.id||"")]=function(){it||ot()},dt=function(n){return tt.$oldViewValue=i(e(n),tt.$oldViewValue,ri)},gt=function(n){return nt.required&&tt.$setValidity("required",!yt(n)),n},tt.$parsers.push(dt),tt.$parsers.unshift(kt),tt.$parsers.unshift(gt),tt.$formatters.push(dt),tt.$formatters.unshift(kt),tt.$formatters.unshift(gt),tt.$formatters.unshift(function(n){return tt.$undoManager.push(n||"")}),ii)if(a.events={},rt){ht=!1;ti=function(n){var f,k,e,u,h,rt,nt,w,l,b,it;if(n&&n.trim().length){if(n.match(/class=["']*Mso(Normal|List)/i)){f=n.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);f=f?f[1]:n;f=f.replace(/<o:p>[\s\S]*?<\/o:p>/ig,"").replace(/class=(["']|)MsoNormal(["']|)/ig,"");var y=angular.element("<div>"+f+"<\/div>"),s=angular.element("<div><\/div>"),t={element:null,lastIndent:[],lastLi:null,isUl:!1};for(t.lastIndent.peek=function(){var n=this.length;if(n>0)return this[n-1]},k=function(n){t.isUl=n;t.element=angular.element(n?"<ul>":"<ol>");t.lastIndent=[];t.lastIndent.peek=function(){var n=this.length;if(n>0)return this[n-1]};t.lastLevelMatch=null},e=0;e<=y[0].childNodes.length;e++)if(y[0].childNodes[e]&&y[0].childNodes[e].nodeName!=="#text"&&y[0].childNodes[e].tagName.toLowerCase()==="p")if(u=angular.element(y[0].childNodes[e]),h=(u.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i),h){if(u[0].childNodes.length<2||u[0].childNodes[1].childNodes.length<1)continue;var p=h[1].toLowerCase()==="bullet"||h[1].toLowerCase()!=="number"&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(u[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(u[0].childNodes[1].childNodes[0].innerHTML)),ut=(u.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),o=parseFloat(ut?ut[1]:0),c=(u.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(c&&c[2]&&(o=parseInt(c[2])),(!c||t.lastLevelMatch&&c[1]===t.lastLevelMatch[1])&&h[3]&&h[3].toLowerCase()!=="first"&&t.lastIndent.peek()!==null&&(t.isUl===p||t.lastIndent.peek()!==o)){if(t.lastIndent.peek()!=null&&t.lastIndent.peek()<o)t.element=angular.element(p?"<ul>":"<ol>"),t.lastLi.append(t.element);else if(t.lastIndent.peek()!=null&&t.lastIndent.peek()>o){while(t.lastIndent.peek()!=null&&t.lastIndent.peek()>o){if(t.element.parent()[0].tagName.toLowerCase()==="li"){t.element=t.element.parent();continue}else if(/[uo]l/i.test(t.element.parent()[0].tagName.toLowerCase()))t.element=t.element.parent();else break;t.lastIndent.pop()}t.isUl=t.element[0].tagName.toLowerCase()==="ul";p!==t.isUl&&(k(p),s.append(t.element))}}else k(p),s.append(t.element);t.lastLevelMatch=c;o!==t.lastIndent.peek()&&t.lastIndent.push(o);t.lastLi=angular.element("<li>");t.element.append(t.lastLi);t.lastLi.html(u.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/ig,""));u.remove()}else k(!1),s.append(u);rt=function(n){n=angular.element(n);for(var t=n[0].childNodes.length-1;t>=0;t--)n.after(n[0].childNodes[t]);n.remove()};angular.forEach(s.find("span"),function(n){n.removeAttribute("lang");n.attributes.length<=0&&rt(n)});angular.forEach(s.find("font"),rt);n=s.html()}else{if(n=n.replace(/<(|\/)meta[^>]*?>/ig,""),n.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(n.match(/<[^>]*?(text-angular)[^>]*?>/)){for(nt=angular.element("<div>"+n+"<\/div>"),nt.find("textarea").remove(),w=d.getByAttribute(nt,"ta-bind"),l=0;l<w.length;l++){for(b=w[l][0].parentNode.parentNode,it=0;it<w[l][0].childNodes.length;it++)b.parentNode.insertBefore(w[l][0].childNodes[it],b);b.parentNode.removeChild(b)}n=nt.html().replace('<br class="Apple-interchange-newline">',"")}}else n.match(/^<span/)&&(n=n.replace(/<(|\/)span[^>]*?>/ig,""));n=n.replace(/<br class="Apple-interchange-newline"[^>]*?>/ig,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/ig,"&nbsp;")}n=i(n,"",ri);/<li(\s.*)?>/i.test(n)&&/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(n)===!1&&(n=n.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&<\/ul>"));wt&&(n=wt(a,{$html:n})||n);v.insertHtml(n,g[0]);r(function(){tt.$setViewValue(et());ht=!1;g.removeClass("processing-paste")},0)}else ht=!1,g.removeClass("processing-paste")};g.on("paste",a.events.paste=function(n,t){var h,i,o,s,c,e;if(t&&angular.extend(n,t),it||ht)return n.stopPropagation(),n.preventDefault(),!1;if(ht=!0,g.addClass("processing-paste"),i=(n.originalEvent||n).clipboardData,i&&i.getData&&i.types.length>0){for(o="",s=0;s<i.types.length;s++)o+=" "+i.types[s];return/text\/html/i.test(o)?h=i.getData("text/html"):/text\/plain/i.test(o)&&(h=i.getData("text/plain")),ti(h),n.stopPropagation(),n.preventDefault(),!1}c=u.rangy.saveSelection();e=angular.element('<div class="ta-hidden-input" contenteditable="true"><\/div>');f.find("body").append(e);e[0].focus();r(function(){u.rangy.restoreSelection(c);ti(e[0].innerHTML);g[0].focus();e.remove()},0)});g.on("cut",a.events.cut=function(n){it?n.preventDefault():r(function(){tt.$setViewValue(et())},0)});g.on("keydown",a.events.keydown=function(n,t){var r,i,u,f;if(t&&angular.extend(n,t),!it)if(!n.altKey&&(n.metaKey||n.ctrlKey))n.keyCode!==90||n.shiftKey?(n.keyCode===90&&n.shiftKey||n.keyCode===89&&!n.shiftKey)&&(ci(),n.preventDefault()):(hi(),n.preventDefault());else if(n.keyCode===13&&!n.shiftKey){if(i=v.getSelectionElement(),!i.tagName.match(s))return;u=angular.element(ut);/^<br(|\/)>$/i.test(i.innerHTML.trim())&&i.parentNode.tagName.toLowerCase()==="blockquote"&&!i.nextSibling?(r=angular.element(i),f=r.parent(),f.after(u),r.remove(),f.children().length===0&&f.remove(),v.setSelectionToElementStart(u[0]),n.preventDefault()):/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(i.innerHTML.trim())&&i.tagName.toLowerCase()==="blockquote"&&(r=angular.element(i),r.after(u),r.remove(),v.setSelectionToElementStart(u[0]),n.preventDefault())}});g.on("keyup",a.events.keyup=function(n,t){var h,i,e,f,c,o;if(t&&angular.extend(n,t),n.keyCode===9){h=v.getSelection();h.start.element===g[0]&&g.children().length&&v.setSelectionToElementStart(g.children()[0]);return}if(st&&r.cancel(st),!it&&!oi.test(n.keyCode)){if(ut!==""&&n.keyCode===13&&!n.shiftKey){for(i=v.getSelectionElement();!i.tagName.match(s)&&i!==g[0];)i=i.parentNode;i.tagName.toLowerCase()!==nt.taDefaultWrap&&i.tagName.toLowerCase()!=="li"&&(i.innerHTML.trim()===""||i.innerHTML.trim()==="<br>")&&(e=angular.element(ut),angular.element(i).replaceWith(e),v.setSelectionToElementStart(e[0]))}f=et();ut!==""&&f.trim()===""?(ft(ut),v.setSelectionToElementStart(g.children()[0])):f.substring(0,1)!=="<"&&nt.taDefaultWrap!==""&&(c=u.rangy.saveSelection(),f=et(),f="<"+nt.taDefaultWrap+">"+f+"<\/"+nt.taDefaultWrap+">",ft(f),u.rangy.restoreSelection(c));o=ui!==n.keyCode&&si.test(n.keyCode);ot(f,o);o||(st=r(function(){tt.$undoManager.push(f)},250));ui=n.keyCode}});g.on("blur",a.events.blur=function(){at=!1;it||ot();vt=!0;tt.$render()});if(nt.placeholder&&(n.ie>8||n.ie===undefined)){if(nt.id)fi=c("#"+nt.id+".placeholder-text:before",'content: "'+nt.placeholder+'"');else throw"textAngular Error: An unique ID is required for placeholders to work";a.$on("$destroy",function(){l(fi)})}g.on("focus",a.events.focus=function(){at=!0;g.removeClass("placeholder-text")});g.on("mouseup",a.events.mouseup=function(){var n=v.getSelection();n.start.element===g[0]&&g.children().length&&v.setSelectionToElementStart(g.children()[0])});g.on("mousedown",a.events.mousedown=function(n,t){t&&angular.extend(n,t);n.stopPropagation()})}else{g.on("change blur",a.events.change=a.events.blur=function(){it||tt.$setViewValue(et())});g.on("keydown",a.events.keydown=function(n,t){var f,u;if(t&&angular.extend(n,t),n.keyCode===9){var r=this.selectionStart,e=this.selectionEnd,i=g.val();n.shiftKey?(f=i.lastIndexOf("\n",r),u=i.lastIndexOf("\t",r),u!==-1&&u>=f&&(g.val(i.substring(0,u)+i.substring(u+1)),this.selectionStart=this.selectionEnd=r-1)):(g.val(i.substring(0,r)+"\t"+i.substring(e)),this.selectionStart=this.selectionEnd=r+1);n.preventDefault()}});pt=function(n,t){for(var i="",r=0;r<t;r++)i+=n;return i};ni=function(n,t){var u="",r=n.childNodes,i;for(t++,u+=pt("\t",t-1)+n.outerHTML.substring(0,n.outerHTML.indexOf("<li")),i=0;i<r.length;i++)r[i].outerHTML&&(u+=r[i].nodeName.toLowerCase()==="ul"||r[i].nodeName.toLowerCase()==="ol"?"\n"+ni(r[i],t):"\n"+pt("\t",t)+r[i].outerHTML);return u+("\n"+pt("\t",t-1)+n.outerHTML.substring(n.outerHTML.lastIndexOf("<")))};tt.$formatters.unshift(function(n){var i=angular.element("<div>"+n+"<\/div>")[0].childNodes,t;if(i.length>0)for(n="",t=0;t<i.length;t++)i[t].outerHTML&&(n.length>0&&(n+="\n"),n+=i[t].nodeName.toLowerCase()==="ul"||i[t].nodeName.toLowerCase()==="ol"?""+ni(i[t],0):""+i[t].outerHTML);return n})}var ct=function(n){return a.$emit("ta-element-select",this),n.preventDefault(),!1},lt=function(n,t){if(t&&angular.extend(n,t),!h&&!it){h=!0;var i;i=n.originalEvent?n.originalEvent.dataTransfer:n.dataTransfer;a.$emit("ta-drop-event",this,n,i);r(function(){h=!1;ot()},100)}},ei=a["reApplyOnSelectorHandlers"+(nt.id||"")]=function(){it||angular.forEach(y,function(n){g.find(n).off("click",ct).on("click",ct)})},ft=function(n){g[0].innerHTML=n};if(tt.$render=function(){var n=tt.$viewValue||"";if(!vt)if(rt&&at&&(g.removeClass("placeholder-text"),g[0].blur(),r(function(){g[0].focus();v.setSelectionToElementEnd(g.children()[g.children().length-1])},1)),rt)if(nt.placeholder?n===""?ft(ut):ft(n):ft(n===""?ut:n),it)g.off("drop",lt);else{ei();g.on("drop",lt)}else g[0].tagName.toLowerCase()!=="textarea"&&g[0].tagName.toLowerCase()!=="input"?ft(p(n)):g.val(n);rt&&nt.placeholder&&(n===""?at?g.removeClass("placeholder-text"):g.addClass("placeholder-text"):g.removeClass("placeholder-text"));vt=!1},nt.taReadonly&&(it=a.$eval(nt.taReadonly),it?(g.addClass("ta-readonly"),(g[0].tagName.toLowerCase()==="textarea"||g[0].tagName.toLowerCase()==="input")&&g.attr("disabled","disabled"),g.attr("contenteditable")!==undefined&&g.attr("contenteditable")&&g.removeAttr("contenteditable")):(g.removeClass("ta-readonly"),g[0].tagName.toLowerCase()==="textarea"||g[0].tagName.toLowerCase()==="input"?g.removeAttr("disabled"):rt&&g.attr("contenteditable","true")),a.$watch(nt.taReadonly,function(n,t){if(t!==n){if(n)g.addClass("ta-readonly"),(g[0].tagName.toLowerCase()==="textarea"||g[0].tagName.toLowerCase()==="input")&&g.attr("disabled","disabled"),g.attr("contenteditable")!==undefined&&g.attr("contenteditable")&&g.removeAttr("contenteditable"),angular.forEach(y,function(n){g.find(n).on("click",ct)}),g.off("drop",lt);else{g.removeClass("ta-readonly");g[0].tagName.toLowerCase()==="textarea"||g[0].tagName.toLowerCase()==="input"?g.removeAttr("disabled"):rt&&g.attr("contenteditable","true");angular.forEach(y,function(n){g.find(n).off("click",ct)});g.on("drop",lt)}it=n}})),rt&&!it){angular.forEach(y,function(n){g.find(n).on("click",ct)});g.on("drop",lt);g.on("blur",function(){n.webkit&&(o=!0)})}}}}]);var h=!1,f=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]),e={};f.constant("taRegisterTool",b);f.value("taTools",e);f.config([function(){angular.forEach(e,function(n,t){delete e[t]})}]);f.run([function(){if(window.rangy){if(window.rangy.init(),!window.rangy.saveSelection)throw"rangy-selectionsaverestore.js is required for textAngular to work correctly.";}else throw"rangy-core.js and rangy-selectionsaverestore.js are required for textAngular to work correctly, rangy-core is not yet loaded.";}]);f.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log","$q","$parse",function(n,t,i,r,u,f,e,o,s,h,c,l){return{require:"?ngModel",scope:{},restrict:"EA",link:function(a,v,y,p){var tt,it,rt,ut,ft,et,g,k,w=y.serial?y.serial:Math.floor(Math.random()*10000000000000000),lt,ot,st,nt,d,ht,ct,b;a._name=y.name?y.name:"textAngularEditor"+w;nt=function(n,i,r){t(function(){var t=function(){n.off(i,t);r.apply(this,arguments)};n.on(i,t)},100)};lt=u(y.taDefaultWrap);angular.extend(a,angular.copy(i),{wrapSelection:function(n,t,i){n.toLowerCase()==="undo"?a["$undoTaBindtaTextElement"+w]():n.toLowerCase()==="redo"?a["$redoTaBindtaTextElement"+w]():(lt(n,!1,t),i&&a["reApplyOnSelectorHandlerstaTextElement"+w](),a.displayElements.text[0].focus())},showHtml:a.$eval(y.taShowHtml)||!1});y.taFocussedClass&&(a.classes.focussed=y.taFocussedClass);y.taTextEditorClass&&(a.classes.textEditor=y.taTextEditorClass);y.taHtmlEditorClass&&(a.classes.htmlEditor=y.taHtmlEditorClass);y.taTextEditorSetup&&(a.setup.textEditorSetup=a.$parent.$eval(y.taTextEditorSetup));y.taHtmlEditorSetup&&(a.setup.htmlEditorSetup=a.$parent.$eval(y.taHtmlEditorSetup));a.fileDropHandler=y.taFileDrop?a.$parent.$eval(y.taFileDrop):a.defaultFileDropHandler;g=v[0].innerHTML;v[0].innerHTML="";a.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea><\/textarea>"),text:angular.element("<div><\/div>"),scrollWindow:angular.element("<div class='ta-scroll-window'><\/div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"><\/div>'),popoverArrow:angular.element('<div class="arrow"><\/div>'),popoverContainer:angular.element('<div class="popover-content"><\/div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"><\/div>'),background:angular.element('<div class="ta-resizer-handle-background"><\/div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"><\/div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"><\/div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"><\/div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"><\/div>')],info:angular.element('<div class="ta-resizer-handle-info"><\/div>')}};a.displayElements.popover.append(a.displayElements.popoverArrow);a.displayElements.popover.append(a.displayElements.popoverContainer);a.displayElements.scrollWindow.append(a.displayElements.popover);a.displayElements.popover.on("mousedown",function(n,t){return t&&angular.extend(n,t),n.preventDefault(),!1});a.showPopover=function(n){a.displayElements.popover.css("display","block");a.reflowPopover(n);s.addClass(a.displayElements.popover,"in");nt(o.find("body"),"click keyup",function(){a.hidePopover()})};a.reflowPopover=function(n){a.displayElements.text[0].offsetHeight-51>n[0].offsetTop?(a.displayElements.popover.css("top",n[0].offsetTop+n[0].offsetHeight+a.displayElements.scrollWindow[0].scrollTop+"px"),a.displayElements.popover.removeClass("top").addClass("bottom")):(a.displayElements.popover.css("top",n[0].offsetTop-54+a.displayElements.scrollWindow[0].scrollTop+"px"),a.displayElements.popover.removeClass("bottom").addClass("top"));var i=a.displayElements.text[0].offsetWidth-a.displayElements.popover[0].offsetWidth,t=n[0].offsetLeft+n[0].offsetWidth/2-a.displayElements.popover[0].offsetWidth/2;a.displayElements.popover.css("left",Math.max(0,Math.min(i,t))+"px");a.displayElements.popoverArrow.css("margin-left",Math.min(t,Math.max(0,t-i))-11+"px")};a.hidePopover=function(){var n=function(){a.displayElements.popover.css("display","");a.displayElements.popoverContainer.attr("style","");a.displayElements.popoverContainer.attr("class","popover-content")};c.when(s.removeClass(a.displayElements.popover,"in",n)).then(n)};a.displayElements.resize.overlay.append(a.displayElements.resize.background);angular.forEach(a.displayElements.resize.anchors,function(n){a.displayElements.resize.overlay.append(n)});a.displayElements.resize.overlay.append(a.displayElements.resize.info);a.displayElements.scrollWindow.append(a.displayElements.resize.overlay);a.reflowResizeOverlay=function(n){n=angular.element(n)[0];a.displayElements.resize.overlay.css({display:"block",left:n.offsetLeft-5+"px",top:n.offsetTop-5+"px",width:n.offsetWidth+10+"px",height:n.offsetHeight+10+"px"});a.displayElements.resize.info.text(n.offsetWidth+" x "+n.offsetHeight)};a.showResizeOverlay=function(n){var t=o.find("body");ot=function(i){var r={width:parseInt(n.attr("width")),height:parseInt(n.attr("height")),x:i.clientX,y:i.clientY},u,f;(r.width===undefined||isNaN(r.width))&&(r.width=n[0].offsetWidth);(r.height===undefined||isNaN(r.height))&&(r.height=n[0].offsetHeight);a.hidePopover();u=r.height/r.width;f=function(t){var i={x:Math.max(0,r.width+(t.clientX-r.x)),y:Math.max(0,r.height+(t.clientY-r.y))},f;t.shiftKey&&(f=i.y/i.x,i.x=u>f?i.x:i.y/u,i.y=u>f?i.x*u:i.y);el=angular.element(n);el.attr("height",Math.max(0,i.y));el.attr("width",Math.max(0,i.x));a.reflowResizeOverlay(n)};t.on("mousemove",f);nt(t,"mouseup",function(i){i.preventDefault();i.stopPropagation();t.off("mousemove",f);a.showPopover(n)});i.stopPropagation();i.preventDefault()};a.displayElements.resize.anchors[3].on("mousedown",ot);a.reflowResizeOverlay(n);nt(t,"click",function(){a.hideResizeOverlay()})};a.hideResizeOverlay=function(){a.displayElements.resize.anchors[3].off("mousedown",ot);a.displayElements.resize.overlay.css("display","")};a.setup.htmlEditorSetup(a.displayElements.html);a.setup.textEditorSetup(a.displayElements.text);a.displayElements.html.attr({id:"taHtmlElement"+w,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html"});a.displayElements.text.attr({id:"taTextElement"+w,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html"});a.displayElements.scrollWindow.attr({"ng-hide":"showHtml"});y.taDefaultWrap&&a.displayElements.text.attr("ta-default-wrap",y.taDefaultWrap);y.taUnsafeSanitizer&&(a.displayElements.text.attr("ta-unsafe-sanitizer",y.taUnsafeSanitizer),a.displayElements.html.attr("ta-unsafe-sanitizer",y.taUnsafeSanitizer));a.displayElements.scrollWindow.append(a.displayElements.text);v.append(a.displayElements.scrollWindow);v.append(a.displayElements.html);a.displayElements.forminput.attr("name",a._name);v.append(a.displayElements.forminput);y.tabindex&&(v.removeAttr("tabindex"),a.displayElements.text.attr("tabindex",y.tabindex),a.displayElements.html.attr("tabindex",y.tabindex));y.placeholder&&(a.displayElements.text.attr("placeholder",y.placeholder),a.displayElements.html.attr("placeholder",y.placeholder));y.taDisabled&&(a.displayElements.text.attr("ta-readonly","disabled"),a.displayElements.html.attr("ta-readonly","disabled"),a.disabled=a.$parent.$eval(y.taDisabled),a.$parent.$watch(y.taDisabled,function(n){a.disabled=n;a.disabled?v.addClass(a.classes.disabled):v.removeClass(a.classes.disabled)}));y.taPaste&&(a._pasteHandler=function(n){return l(y.taPaste)(a.$parent,{$html:n})},a.displayElements.text.attr("ta-paste","_pasteHandler($html)"));n(a.displayElements.scrollWindow)(a);n(a.displayElements.html)(a);a.updateTaBindtaTextElement=a["updateTaBindtaTextElement"+w];a.updateTaBindtaHtmlElement=a["updateTaBindtaHtmlElement"+w];v.addClass("ta-root");a.displayElements.scrollWindow.addClass("ta-text ta-editor "+a.classes.textEditor);a.displayElements.html.addClass("ta-html ta-editor "+a.classes.htmlEditor);a._actionRunning=!1;d=!1;a.startAction=function(){return a._actionRunning=!0,d=e.rangy.saveSelection(),function(){d&&e.rangy.restoreSelection(d)}};a.endAction=function(){a._actionRunning=!1;d&&e.rangy.removeMarkers(d);d=!1;a.updateSelectedStyles();a.showHtml||a["updateTaBindtaTextElement"+w]()};ft=function(){a.focussed=!0;v.addClass(a.classes.focussed);k.focus();v.triggerHandler("focus")};a.displayElements.html.on("focus",ft);a.displayElements.text.on("focus",ft);et=function(n){return a._actionRunning||o[0].activeElement===a.displayElements.html[0]||o[0].activeElement===a.displayElements.text[0]||(v.removeClass(a.classes.focussed),k.unfocus(),t(function(){a._bUpdateSelectedStyles=!1;v.triggerHandler("blur");a.focussed=!1},0)),n.preventDefault(),!1};a.displayElements.html.on("blur",et);a.displayElements.text.on("blur",et);a.displayElements.text.on("paste",function(n){v.triggerHandler("paste",n)});a.queryFormatBlockState=function(n){return!a.showHtml&&n.toLowerCase()===o[0].queryCommandValue("formatBlock").toLowerCase()};a.queryCommandState=function(n){return a.showHtml?"":o[0].queryCommandState(n)};a.switchView=function(){a.showHtml=!a.showHtml;s.enabled(!1,a.displayElements.html);s.enabled(!1,a.displayElements.text);a.showHtml?t(function(){return s.enabled(!0,a.displayElements.html),s.enabled(!0,a.displayElements.text),a.displayElements.html[0].focus()},100):t(function(){return s.enabled(!0,a.displayElements.html),s.enabled(!0,a.displayElements.text),a.displayElements.text[0].focus()},100)};y.ngModel?(ht=!0,p.$render=function(){if(ht){ht=!1;var n=a.$parent.$eval(y.ngModel);(n===undefined||n===null)&&g&&g!==""&&p.$setViewValue(g)}a.displayElements.forminput.val(p.$viewValue);a._elementSelectTriggered||(a.html=p.$viewValue||"")},ct=function(n){return y.required&&p.$setValidity("required",!(!n||n.trim()==="")),n},p.$parsers.push(ct),p.$formatters.push(ct)):(a.displayElements.forminput.val(g),a.html=g);a.$watch("html",function(n,t){n!==t&&(y.ngModel&&p.$viewValue!==n&&p.$setViewValue(n),a.displayElements.forminput.val(n))});y.taTargetToolbars?k=f.registerEditor(a._name,a,y.taTargetToolbars.split(",")):(b=angular.element('<div text-angular-toolbar name="textAngularToolbar'+w+'">'),y.taToolbar&&b.attr("ta-toolbar",y.taToolbar),y.taToolbarClass&&b.attr("ta-toolbar-class",y.taToolbarClass),y.taToolbarGroupClass&&b.attr("ta-toolbar-group-class",y.taToolbarGroupClass),y.taToolbarButtonClass&&b.attr("ta-toolbar-button-class",y.taToolbarButtonClass),y.taToolbarActiveButtonClass&&b.attr("ta-toolbar-active-button-class",y.taToolbarActiveButtonClass),y.taFocussedClass&&b.attr("ta-focussed-class",y.taFocussedClass),v.prepend(b),n(b)(a.$parent),k=f.registerEditor(a._name,a,["textAngularToolbar"+w]));a.$on("$destroy",function(){f.unregisterEditor(a._name)});a.$on("ta-element-select",function(n,t){k.triggerElementSelect(n,t)&&a["reApplyOnSelectorHandlerstaTextElement"+w]()});a.$on("ta-drop-event",function(n,i,r,u){a.displayElements.text[0].focus();u&&u.files&&u.files.length>0?(angular.forEach(u.files,function(n){try{c.when(a.fileDropHandler(n,a.wrapSelection)||a.fileDropHandler!==a.defaultFileDropHandler&&c.when(a.defaultFileDropHandler(n,a.wrapSelection))).then(function(){a["updateTaBindtaTextElement"+w]()})}catch(t){h.error(t)}}),r.preventDefault(),r.stopPropagation()):t(function(){a["updateTaBindtaTextElement"+w]()},0)});a._bUpdateSelectedStyles=!1;angular.element(window).on("blur",function(){a._bUpdateSelectedStyles=!1;a.focussed=!1});a.updateSelectedStyles=function(){var n;st&&t.cancel(st);(n=r.getSelectionElement())!==undefined&&n.parentNode!==a.displayElements.text[0]?k.updateSelectedStyles(angular.element(n)):k.updateSelectedStyles();a._bUpdateSelectedStyles&&(st=t(a.updateSelectedStyles,200))};tt=function(){if(!a.focussed){a._bUpdateSelectedStyles=!1;return}a._bUpdateSelectedStyles||(a._bUpdateSelectedStyles=!0,a.$apply(function(){a.updateSelectedStyles()}))};a.displayElements.html.on("keydown",tt);a.displayElements.text.on("keydown",tt);it=function(){a._bUpdateSelectedStyles=!1};a.displayElements.html.on("keyup",it);a.displayElements.text.on("keyup",it);rt=function(n,t){t&&angular.extend(n,t);a.$apply(function(){if(k.sendKeyCommand(n))return a._bUpdateSelectedStyles||a.updateSelectedStyles(),n.preventDefault(),!1})};a.displayElements.html.on("keypress",rt);a.displayElements.text.on("keypress",rt);ut=function(){a._bUpdateSelectedStyles=!1;a.$apply(function(){a.updateSelectedStyles()})};a.displayElements.html.on("mouseup",ut);a.displayElements.text.on("mouseup",ut)}}}]);f.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(n,t,i){var r={},u={};return{registerEditor:function(i,f,e){if(!i||i==="")throw"textAngular Error: An editor requires a name";if(!f)throw"textAngular Error: An editor requires a scope";if(u[i])throw'textAngular Error: An Editor with name "'+i+'" already exists';var o=[];return angular.forEach(e,function(n){r[n]&&o.push(r[n])}),u[i]={scope:f,toolbars:e,_registerToolbar:function(n){this.toolbars.indexOf(n.name)>=0&&o.push(n)},editorFunctions:{disable:function(){angular.forEach(o,function(n){n.disabled=!0})},enable:function(){angular.forEach(o,function(n){n.disabled=!1})},focus:function(){angular.forEach(o,function(n){n._parent=f;n.disabled=!1;n.focussed=!0;f.focussed=!0})},unfocus:function(){angular.forEach(o,function(n){n.disabled=!0;n.focussed=!1});f.focussed=!1},updateSelectedStyles:function(n){angular.forEach(o,function(t){angular.forEach(t.tools,function(i){i.activeState&&(t._parent=f,i.active=i.activeState(n))})})},sendKeyCommand:function(i){var r=!1;return(i.ctrlKey||i.metaKey)&&angular.forEach(t,function(t,u){if(t.commandKeyCode&&t.commandKeyCode===i.which)for(var e=0;e<o.length;e++)if(o[e].tools[u]!==undefined){n.call(o[e].tools[u],f);r=!0;break}}),r},triggerElementSelect:function(n,i){var h=function(n,t){for(var i=!0,r=0;r<t.length;r++)i=i&&n.attr(t[r]);return i},r=[],c={},l=!1,s,u,v,a,e;if(i=angular.element(i),s=!1,angular.forEach(t,function(n,t){n.onElementSelect&&n.onElementSelect.element&&n.onElementSelect.element.toLowerCase()===i[0].tagName.toLowerCase()&&(!n.onElementSelect.filter||n.onElementSelect.filter(i))&&(s=s||angular.isArray(n.onElementSelect.onlyWithAttrs)&&h(i,n.onElementSelect.onlyWithAttrs),(!n.onElementSelect.onlyWithAttrs||h(i,n.onElementSelect.onlyWithAttrs))&&(c[t]=n))}),s?(angular.forEach(c,function(n,t){n.onElementSelect.onlyWithAttrs&&h(i,n.onElementSelect.onlyWithAttrs)&&r.push({name:t,tool:n})}),r.sort(function(n,t){return t.tool.onElementSelect.onlyWithAttrs.length-n.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(c,function(n,t){r.push({name:t,tool:n})}),r.length>0)for(u=0;u<r.length;u++){for(v=r[u].tool,a=r[u].name,e=0;e<o.length;e++)if(o[e].tools[a]!==undefined){v.onElementSelect.action.call(o[e].tools[a],n,i,f);l=!0;break}if(l)break}return l}}},u[i].editorFunctions},retrieveEditor:function(n){return u[n]},unregisterEditor:function(n){delete u[n]},registerToolbar:function(n){if(!n)throw"textAngular Error: A toolbar requires a scope";if(!n.name||n.name==="")throw"textAngular Error: A toolbar requires a name";if(r[n.name])throw'textAngular Error: A toolbar with name "'+n.name+'" already exists';r[n.name]=n;angular.forEach(u,function(t){t._registerToolbar(n)})},retrieveToolbar:function(n){return r[n]},retrieveToolbarsViaEditor:function(n){var t=[],i=this;return angular.forEach(this.retrieveEditor(n).toolbars,function(n){t.push(i.retrieveToolbar(n))}),t},unregisterToolbar:function(n){delete r[n]},updateToolsDisplay:function(n){var t=this;angular.forEach(n,function(n,i){t.updateToolDisplay(i,n)})},resetToolsDisplay:function(){var n=this;angular.forEach(t,function(t,i){n.resetToolDisplay(i)})},updateToolDisplay:function(n,t){var i=this;angular.forEach(r,function(r,u){i.updateToolbarToolDisplay(u,n,t)})},resetToolDisplay:function(n){var t=this;angular.forEach(r,function(i,r){t.resetToolbarToolDisplay(r,n)})},updateToolbarToolDisplay:function(n,t,i){if(r[n])r[n].updateToolDisplay(t,i);else throw'textAngular Error: No Toolbar with name "'+n+'" exists';},resetToolbarToolDisplay:function(n,i){if(r[n])r[n].updateToolDisplay(i,t[i],!0);else throw'textAngular Error: No Toolbar with name "'+n+'" exists';},removeTool:function(n){delete t[n];angular.forEach(r,function(t){var r,i,u;for(delete t.tools[n],r=0;r<t.toolbar.length;r++){for(u=0;u<t.toolbar[r].length;u++){if(t.toolbar[r][u]===n){i={group:r,index:u};break}if(i!==undefined)break}i!==undefined&&(t.toolbar[i.group].slice(i.index,1),t._$element.children().eq(i.group).children().eq(i.index).remove())}})},addTool:function(n,t,u,f){i(n,t);angular.forEach(r,function(i){i.addTool(n,t,u,f)})},addToolToToolbar:function(n,t,u,f,e){i(n,t);r[u].addTool(n,t,f,e)},refreshEditor:function(n){if(u[n])u[n].scope.updateTaBindtaTextElement(),u[n].scope.$$phase||u[n].scope.$digest();else throw'textAngular Error: No Editor with name "'+n+'" exists';}}}]);f.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(n,t,i,r,u,f){return{scope:{name:"@"},restrict:"EA",link:function(e,o,s){var h,c;if(!e.name||e.name==="")throw"textAngular Error: A toolbar requires a name";angular.extend(e,angular.copy(i));s.taToolbar&&(e.toolbar=e.$parent.$eval(s.taToolbar));s.taToolbarClass&&(e.classes.toolbar=s.taToolbarClass);s.taToolbarGroupClass&&(e.classes.toolbarGroup=s.taToolbarGroupClass);s.taToolbarButtonClass&&(e.classes.toolbarButton=s.taToolbarButtonClass);s.taToolbarActiveButtonClass&&(e.classes.toolbarButtonActive=s.taToolbarActiveButtonClass);s.taFocussedClass&&(e.classes.focussed=s.taFocussedClass);e.disabled=!0;e.focussed=!1;e._$element=o;o[0].innerHTML="";o.addClass("ta-toolbar "+e.classes.toolbar);e.$watch("focussed",function(){e.focussed?o.addClass(e.classes.focussed):o.removeClass(e.classes.focussed)});h=function(t,i){var r,f,u;r=t&&t.display?angular.element(t.display):angular.element("<button type='button'>");t&&t["class"]?r.addClass(t["class"]):r.addClass(e.classes.toolbarButton);r.attr("name",i.name);r.attr("unselectable","on");r.attr("ng-disabled","isDisabled()");r.attr("tabindex","-1");r.attr("ng-click","executeAction()");r.attr("ng-class","displayActiveToolClass(active)");t&&t.tooltiptext&&r.attr("title",t.tooltiptext);r.on("mousedown",function(n,t){return t&&angular.extend(n,t),n.preventDefault(),!1});return!t||t.display||i._display||(r[0].innerHTML="",t.buttontext&&(r[0].innerHTML=t.buttontext),t.iconclass&&(f=angular.element("<i>"),u=r[0].innerHTML,f.addClass(t.iconclass),r[0].innerHTML="",r.append(f),u&&u!==""&&r.append("&nbsp;"+u))),i._lastToolDefinition=angular.copy(t),n(r)(i)};e.tools={};e._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};c={$window:f,$editor:function(){return e._parent},isDisabled:function(){return typeof this.$eval("disabled")!="function"&&this.$eval("disabled")||this.$eval("disabled()")||this.name!=="html"&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(n){return n?e.classes.toolbarButtonActive:""},executeAction:u};angular.forEach(e.toolbar,function(n){var t=angular.element("<div>");t.addClass(e.classes.toolbarGroup);angular.forEach(n,function(n){e.tools[n]=angular.extend(e.$new(!0),r[n],c,{name:n});e.tools[n].$element=h(r[n],e.tools[n]);t.append(e.tools[n].$element)});o.append(t)});e.updateToolDisplay=function(n,t,i){var r=e.tools[n],u;if(r){if(r._lastToolDefinition&&!i&&(t=angular.extend({},r._lastToolDefinition,t)),t.buttontext===null&&t.iconclass===null&&t.display===null)throw'textAngular Error: Tool Definition for updating "'+n+'" does not have a valid display/iconclass/buttontext value';t.buttontext===null&&delete t.buttontext;t.iconclass===null&&delete t.iconclass;t.display===null&&delete t.display;u=h(t,r);r.$element.replaceWith(u);r.$element=u}};e.addTool=function(n,t,i,u){e.tools[n]=angular.extend(e.$new(!0),r[n],c,{name:n});e.tools[n].$element=h(r[n],e.tools[n]);var f;i===undefined&&(i=e.toolbar.length-1);f=angular.element(o.children()[i]);u===undefined?(f.append(e.tools[n].$element),e.toolbar[i][e.toolbar[i].length-1]=n):(f.children().eq(u).after(e.tools[n].$element),e.toolbar[i][u]=n)};t.registerToolbar(e);e.$on("$destroy",function(){t.unregisterToolbar(e.name)})}}}])})();
/*
//# sourceMappingURL=textAngular.min.js.map
*/