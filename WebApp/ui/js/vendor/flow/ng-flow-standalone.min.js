/**
 * @license MIT
 */
(function(n,t,i){"use strict";function u(t){if(this.support=typeof File!="undefined"&&typeof Blob!="undefined"&&typeof FileList!="undefined"&&(!!Blob.prototype.slice||!!Blob.prototype.webkitSlice||!!Blob.prototype.mozSlice||!1),this.support){this.supportDirectory=/WebKit/.test(n.navigator.userAgent);this.files=[];this.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,singleFile:!1,fileParameterName:"file",progressCallbacksInterval:500,speedSmoothingFactor:.1,query:{},headers:{},withCredentials:!1,preprocess:null,method:"multipart",testMethod:"GET",uploadMethod:"POST",prioritizeFirstAndLastChunk:!1,target:"/",testChunks:!0,generateUniqueIdentifier:null,maxChunkRetries:0,chunkRetryInterval:null,permanentErrors:[404,415,500,501],successStatuses:[200,201,202],onDropStopPropagation:!1};this.opts={};this.events={};var i=this;this.onDrop=function(n){i.opts.onDropStopPropagation&&n.stopPropagation();n.preventDefault();var t=n.dataTransfer;t.items&&t.items[0]&&t.items[0].webkitGetAsEntry?i.webkitReadDataTransfer(n):i.addFiles(t.files,n)};this.preventEvent=function(n){n.preventDefault()};this.opts=u.extend({},this.defaults,t||{})}}function e(n,t){this.flowObj=n;this.file=t;this.name=t.fileName||t.name;this.size=t.size;this.relativePath=t.relativePath||t.webkitRelativePath||this.name;this.uniqueIdentifier=n.generateUniqueIdentifier(t);this.chunks=[];this.paused=!1;this.error=!1;this.averageSpeed=0;this.currentSpeed=0;this._lastProgressCallback=Date.now();this._prevUploadedSize=0;this._prevProgress=0;this.bootstrap()}function o(n,t,i){var u,r;this.flowObj=n;this.fileObj=t;this.fileObjSize=t.size;this.offset=i;this.tested=!1;this.retries=0;this.pendingRetry=!1;this.preprocessState=0;this.loaded=0;this.total=0;u=this.flowObj.opts.chunkSize;this.startByte=this.offset*u;this.endByte=Math.min(this.fileObjSize,(this.offset+1)*u);this.xhr=null;this.fileObjSize-this.endByte<u&&!this.flowObj.opts.forceChunkSize&&(this.endByte=this.fileObjSize);r=this;this.event=function(n,t){t=Array.prototype.slice.call(arguments);t.unshift(r);r.fileObj.chunkEvent.apply(r.fileObj,t)};this.progressHandler=function(n){n.lengthComputable&&(r.loaded=n.loaded,r.total=n.total);r.event("progress",n)};this.testHandler=function(){var n=r.status(!0);n==="error"?(r.event(n,r.message()),r.flowObj.uploadNextChunk()):n==="success"?(r.tested=!0,r.event(n,r.message()),r.flowObj.uploadNextChunk()):r.fileObj.paused||(r.tested=!0,r.send())};this.doneHandler=function(){var n=r.status(),t;n==="success"||n==="error"?(r.event(n,r.message()),r.flowObj.uploadNextChunk()):(r.event("retry",r.message()),r.pendingRetry=!0,r.abort(),r.retries++,t=r.flowObj.opts.chunkRetryInterval,t!==null?setTimeout(function(){r.send()},t):r.send())}}function l(n,t){var i=n.indexOf(t);i>-1&&n.splice(i,1)}function f(n,t){return typeof n=="function"&&(t=Array.prototype.slice.call(arguments),n=n.apply(null,t.slice(1))),n}function c(n,t){setTimeout(n.bind(t),0)}function s(n){return r(arguments,function(t){t!==n&&r(t,function(t,i){n[i]=t})}),n}function r(n,t,i){if(n){var r;if(typeof n.length!="undefined"){for(r=0;r<n.length;r++)if(t.call(i,n[r],r)===!1)return}else for(r in n)if(n.hasOwnProperty(r)&&t.call(i,n[r],r)===!1)return}}var h=n.navigator.msPointerEnabled;u.prototype={on:function(n,t){n=n.toLowerCase();this.events.hasOwnProperty(n)||(this.events[n]=[]);this.events[n].push(t)},off:function(n,t){n!==i?(n=n.toLowerCase(),t!==i?this.events.hasOwnProperty(n)&&l(this.events[n],t):delete this.events[n]):this.events={}},fire:function(n,t){t=Array.prototype.slice.call(arguments);n=n.toLowerCase();var i=!1;return this.events.hasOwnProperty(n)&&r(this.events[n],function(n){i=n.apply(this,t.slice(1))===!1||i},this),n!="catchall"&&(t.unshift("catchAll"),i=this.fire.apply(this,t)===!1||i),!i},webkitReadDataTransfer:function(n){function e(n){u+=n.length;r(n,function(n){if(n.isFile){var i=n.fullPath;n.file(function(n){o(n,i)},t)}else n.isDirectory&&n.createReader().readEntries(e,t)});i()}function o(n,t){n.relativePath=t.substring(1);f.push(n);i()}function t(n){throw n;}function i(){--u==0&&s.addFiles(f,n)}var s=this,u=n.dataTransfer.items.length,f=[];r(n.dataTransfer.items,function(n){var r=n.webkitGetAsEntry();if(!r){i();return}r.isFile?o(n.getAsFile(),r.fullPath):r.createReader().readEntries(e,t)})},generateUniqueIdentifier:function(n){var t=this.opts.generateUniqueIdentifier,i;return typeof t=="function"?t(n):(i=n.relativePath||n.webkitRelativePath||n.fileName||n.name,n.size+"-"+i.replace(/[^0-9a-zA-Z_-]/img,""))},uploadNextChunk:function(n){var t=!1,i;return this.opts.prioritizeFirstAndLastChunk&&(r(this.files,function(n){return!n.paused&&n.chunks.length&&n.chunks[0].status()==="pending"&&n.chunks[0].preprocessState===0?(n.chunks[0].send(),t=!0,!1):!n.paused&&n.chunks.length>1&&n.chunks[n.chunks.length-1].status()==="pending"&&n.chunks[0].preprocessState===0?(n.chunks[n.chunks.length-1].send(),t=!0,!1):void 0}),t)?t:(r(this.files,function(n){return n.paused||r(n.chunks,function(n){if(n.status()==="pending"&&n.preprocessState===0)return n.send(),t=!0,!1}),t?!1:void 0}),t)?!0:(i=!1,r(this.files,function(n){if(!n.isComplete())return i=!0,!1}),i||n||c(function(){this.fire("complete")},this),!1)},assignBrowse:function(n,i,u,f){typeof n.length=="undefined"&&(n=[n]);r(n,function(n){var e,o;n.tagName==="INPUT"&&n.type==="file"?e=n:(e=t.createElement("input"),e.setAttribute("type","file"),s(e.style,{visibility:"hidden",position:"absolute"}),n.appendChild(e),n.addEventListener("click",function(){e.click()},!1));this.opts.singleFile||u||e.setAttribute("multiple","multiple");i&&e.setAttribute("webkitdirectory","webkitdirectory");r(f,function(n,t){e.setAttribute(t,n)});o=this;e.addEventListener("change",function(n){o.addFiles(n.target.files,n);n.target.value=""},!1)},this)},assignDrop:function(n){typeof n.length=="undefined"&&(n=[n]);r(n,function(n){n.addEventListener("dragover",this.preventEvent,!1);n.addEventListener("dragenter",this.preventEvent,!1);n.addEventListener("drop",this.onDrop,!1)},this)},unAssignDrop:function(n){typeof n.length=="undefined"&&(n=[n]);r(n,function(n){n.removeEventListener("dragover",this.preventEvent);n.removeEventListener("dragenter",this.preventEvent);n.removeEventListener("drop",this.onDrop)},this)},isUploading:function(){var n=!1;return r(this.files,function(t){if(t.isUploading())return n=!0,!1}),n},_shouldUploadNext:function(){var n=0,t=!0,i=this.opts.simultaneousUploads;return r(this.files,function(u){r(u.chunks,function(r){if(r.status()==="uploading"&&(n++,n>=i))return t=!1,!1})}),t&&n},upload:function(){var i=this._shouldUploadNext(),n,t;if(i!==!1){for(this.fire("uploadStart"),n=!1,t=1;t<=this.opts.simultaneousUploads-i;t++)n=this.uploadNextChunk(!0)||n;n||c(function(){this.fire("complete")},this)}},resume:function(){r(this.files,function(n){n.resume()})},pause:function(){r(this.files,function(n){n.pause()})},cancel:function(){for(var n=this.files.length-1;n>=0;n--)this.files[n].cancel()},progress:function(){var t=0,n=0;return r(this.files,function(i){t+=i.progress()*i.size;n+=i.size}),n>0?t/n:0},addFile:function(n,t){this.addFiles([n],t)},addFiles:function(n,t){var i=[];r(n,function(n){if((!h||h&&n.size>0)&&!(n.size%4096==0&&(n.name==="."||n.fileName==="."))&&!this.getFromUniqueIdentifier(this.generateUniqueIdentifier(n))){var r=new e(this,n);this.fire("fileAdded",r,t)&&i.push(r)}},this);this.fire("filesAdded",i,t)&&r(i,function(n){this.opts.singleFile&&this.files.length>0&&this.removeFile(this.files[0]);this.files.push(n)},this);this.fire("filesSubmitted",i,t)},removeFile:function(n){for(var t=this.files.length-1;t>=0;t--)this.files[t]===n&&(this.files.splice(t,1),n.abort())},getFromUniqueIdentifier:function(n){var t=!1;return r(this.files,function(i){i.uniqueIdentifier===n&&(t=i)}),t},getSize:function(){var n=0;return r(this.files,function(t){n+=t.size}),n},sizeUploaded:function(){var n=0;return r(this.files,function(t){n+=t.sizeUploaded()}),n},timeRemaining:function(){var n=0,t=0;return(r(this.files,function(i){i.paused||i.error||(n+=i.size-i.sizeUploaded(),t+=i.averageSpeed)}),n&&!t)?Number.POSITIVE_INFINITY:!n&&!t?0:Math.floor(n/t)}};e.prototype={measureSpeed:function(){var i=Date.now()-this._lastProgressCallback,n,t;i&&(n=this.flowObj.opts.speedSmoothingFactor,t=this.sizeUploaded(),this.currentSpeed=Math.max((t-this._prevUploadedSize)/i*1e3,0),this.averageSpeed=n*this.currentSpeed+(1-n)*this.averageSpeed,this._prevUploadedSize=t)},chunkEvent:function(n,t,i){switch(t){case"progress":if(Date.now()-this._lastProgressCallback<this.flowObj.opts.progressCallbacksInterval)break;this.measureSpeed();this.flowObj.fire("fileProgress",this,n);this.flowObj.fire("progress");this._lastProgressCallback=Date.now();break;case"error":this.error=!0;this.abort(!0);this.flowObj.fire("fileError",this,i,n);this.flowObj.fire("error",i,this,n);break;case"success":if(this.error)return;this.measureSpeed();this.flowObj.fire("fileProgress",this,n);this.flowObj.fire("progress");this._lastProgressCallback=Date.now();this.isComplete()&&(this.currentSpeed=0,this.averageSpeed=0,this.flowObj.fire("fileSuccess",this,i,n));break;case"retry":this.flowObj.fire("fileRetry",this,n)}},pause:function(){this.paused=!0;this.abort()},resume:function(){this.paused=!1;this.flowObj.upload()},abort:function(n){this.currentSpeed=0;this.averageSpeed=0;var t=this.chunks;n&&(this.chunks=[]);r(t,function(n){n.status()==="uploading"&&(n.abort(),this.flowObj.uploadNextChunk())},this)},cancel:function(){this.flowObj.removeFile(this)},retry:function(){this.bootstrap();this.flowObj.upload()},bootstrap:function(){var t,i,n;for(this.abort(!0),this.error=!1,this._prevProgress=0,t=this.flowObj.opts.forceChunkSize?Math.ceil:Math.floor,i=Math.max(t(this.file.size/this.flowObj.opts.chunkSize),1),n=0;n<i;n++)this.chunks.push(new o(this.flowObj,this,n))},progress:function(){var n,t;return this.error?1:this.chunks.length===1?(this._prevProgress=Math.max(this._prevProgress,this.chunks[0].progress()),this._prevProgress):(n=0,r(this.chunks,function(t){n+=t.progress()*(t.endByte-t.startByte)}),t=n/this.size,this._prevProgress=Math.max(this._prevProgress,t>.9999?1:t),this._prevProgress)},isUploading:function(){var n=!1;return r(this.chunks,function(t){if(t.status()==="uploading")return n=!0,!1}),n},isComplete:function(){var n=!1;return r(this.chunks,function(t){var i=t.status();if(i==="pending"||i==="uploading"||t.preprocessState===1)return n=!0,!1}),!n},sizeUploaded:function(){var n=0;return r(this.chunks,function(t){n+=t.sizeUploaded()}),n},timeRemaining:function(){if(this.paused||this.error)return 0;var n=this.size-this.sizeUploaded();return n&&!this.averageSpeed?Number.POSITIVE_INFINITY:!n&&!this.averageSpeed?0:Math.floor(n/this.averageSpeed)},getType:function(){return this.file.type&&this.file.type.split("/")[1]},getExtension:function(){return this.name.substr((~-this.name.lastIndexOf(".")>>>0)+2).toLowerCase()}};o.prototype={getParams:function(){return{flowChunkNumber:this.offset+1,flowChunkSize:this.flowObj.opts.chunkSize,flowCurrentChunkSize:this.endByte-this.startByte,flowTotalSize:this.fileObjSize,flowIdentifier:this.fileObj.uniqueIdentifier,flowFilename:this.fileObj.name,flowRelativePath:this.fileObj.relativePath,flowTotalChunks:this.fileObj.chunks.length}},getTarget:function(n,t){return n+=n.indexOf("?")<0?"?":"&",n+t.join("&")},test:function(){this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",this.testHandler,!1);this.xhr.addEventListener("error",this.testHandler,!1);var n=f(this.flowObj.opts.testMethod,this.fileObj,this),t=this.prepareXhrRequest(n,!0);this.xhr.send(t)},preprocessFinished:function(){this.preprocessState=2;this.send()},send:function(){var n=this.flowObj.opts.preprocess,t,i,r,u;if(typeof n=="function")switch(this.preprocessState){case 0:this.preprocessState=1;n(this);return;case 1:return}if(this.flowObj.opts.testChunks&&!this.tested){this.test();return}this.loaded=0;this.total=0;this.pendingRetry=!1;t=this.fileObj.file.slice?"slice":this.fileObj.file.mozSlice?"mozSlice":this.fileObj.file.webkitSlice?"webkitSlice":"slice";i=this.fileObj.file[t](this.startByte,this.endByte,this.fileObj.file.type);this.xhr=new XMLHttpRequest;this.xhr.upload.addEventListener("progress",this.progressHandler,!1);this.xhr.addEventListener("load",this.doneHandler,!1);this.xhr.addEventListener("error",this.doneHandler,!1);r=f(this.flowObj.opts.uploadMethod,this.fileObj,this);u=this.prepareXhrRequest(r,!1,this.flowObj.opts.method,i);this.xhr.send(u)},abort:function(){var n=this.xhr;this.xhr=null;n&&n.abort()},status:function(n){return this.pendingRetry||this.preprocessState===1?"uploading":this.xhr?this.xhr.readyState<4?"uploading":this.flowObj.opts.successStatuses.indexOf(this.xhr.status)>-1?"success":this.flowObj.opts.permanentErrors.indexOf(this.xhr.status)>-1||!n&&this.retries>=this.flowObj.opts.maxChunkRetries?"error":(this.abort(),"pending"):"pending"},message:function(){return this.xhr?this.xhr.responseText:""},progress:function(){if(this.pendingRetry)return 0;var n=this.status();return n==="success"||n==="error"?1:n==="pending"?0:this.total>0?this.loaded/this.total:0},sizeUploaded:function(){var n=this.endByte-this.startByte;return this.status()!=="success"&&(n=this.progress()*n),n},prepareXhrRequest:function(n,t,i,u){var o=f(this.flowObj.opts.query,this.fileObj,this,t),h,e,c;return o=s(this.getParams(),o),h=f(this.flowObj.opts.target,this.fileObj,this,t),e=null,n==="GET"||i==="octet"?(c=[],r(o,function(n,t){c.push([encodeURIComponent(t),encodeURIComponent(n)].join("="))}),h=this.getTarget(h,c),e=u||null):(e=new FormData,r(o,function(n,t){e.append(t,n)}),e.append(this.flowObj.opts.fileParameterName,u,this.fileObj.file.name)),this.xhr.open(n,h,!0),this.xhr.withCredentials=this.flowObj.opts.withCredentials,r(f(this.flowObj.opts.headers,this.fileObj,this,t),function(n,t){this.xhr.setRequestHeader(t,n)},this),e}};u.evalOpts=f;u.extend=s;u.each=r;u.FlowFile=e;u.FlowChunk=o;u.version="2.9.0";typeof module=="object"&&module&&typeof module.exports=="object"?module.exports=u:(n.Flow=u,typeof define=="function"&&define.amd&&define("flow",[],function(){return u}))})(window,document);angular.module("flow.provider",[]).provider("flowFactory",function(){"use strict";this.defaults={};this.factory=function(n){return new Flow(n)};this.events=[];this.on=function(n,t){this.events.push([n,t])};this.$get=function(){var n=this.factory,t=this.defaults,i=this.events;return{create:function(r){var u=n(angular.extend({},t,r));return angular.forEach(i,function(n){u.on(n[0],n[1])}),u}}}});angular.module("flow.init",["flow.provider"]).controller("flowCtrl",["$scope","$attrs","$parse","flowFactory",function(n,t,i,r){var e=angular.extend({},n.$eval(t.flowInit)),u=n.$eval(t.flowObject)||r.create(e),f=function(t){var i=Array.prototype.slice.call(arguments),r;return i.shift(),r=n.$broadcast.apply(n,["flow::"+t,u].concat(i)),{progress:1,filesSubmitted:1,fileSuccess:1,fileError:1,complete:1}[t]&&n.$apply(),r.defaultPrevented?!1:void 0};u.on("catchAll",f);n.$on("$destroy",function(){u.off("catchAll",f)});n.$flow=u;t.hasOwnProperty("flowName")&&(i(t.flowName).assign(n,u),n.$on("$destroy",function(){i(t.flowName).assign(n)}))}]).directive("flowInit",[function(){return{scope:!0,controller:"flowCtrl"}}]);angular.module("flow.btn",["flow.init"]).directive("flowBtn",[function(){return{restrict:"EA",scope:!1,require:"^flowInit",link:function(n,t,i){var r=i.hasOwnProperty("flowDirectory"),u=i.hasOwnProperty("flowSingleFile"),f=i.hasOwnProperty("flowAttrs")&&n.$eval(i.flowAttrs);n.$flow.assignBrowse(t,r,u,f)}}}]);angular.module("flow.dragEvents",["flow.init"]).directive("flowPreventDrop",function(){return{scope:!1,link:function(n,t){t.bind("drop dragover",function(n){n.preventDefault()})}}}).directive("flowDragEnter",["$timeout",function(n){return{scope:!1,link:function(t,i,r){function e(n){var t=!1,i=n.dataTransfer||n.originalEvent.dataTransfer;return angular.forEach(i&&i.types,function(n){n==="Files"&&(t=!0)}),t}var u,f=!1;i.bind("dragover",function(i){e(i)&&(f||(t.$apply(r.flowDragEnter),f=!0),n.cancel(u),i.preventDefault())});i.bind("dragleave drop",function(){n.cancel(u);u=n(function(){t.$eval(r.flowDragLeave);u=null;f=!1},100)})}}}]);angular.module("flow.drop",["flow.init"]).directive("flowDrop",function(){return{scope:!1,require:"^flowInit",link:function(n,t,i){function r(){n.$flow.assignDrop(t)}function u(){n.$flow.unAssignDrop(t)}i.flowDropEnabled?n.$watch(i.flowDropEnabled,function(n){n?r():u()}):r()}}});!function(n){"use strict";function i(n){return n.charAt(0).toUpperCase()+n.slice(1)}var t=n.module("flow.events",["flow.init"]);n.forEach({fileSuccess:["$file","$message"],fileProgress:["$file"],fileAdded:["$file","$event"],filesAdded:["$files","$event"],filesSubmitted:["$files","$event"],fileRetry:["$file"],fileError:["$file","$message"],uploadStart:[],complete:[],progress:[],error:["$message","$file"]},function(r,u){var f="flow"+i(u);f=="flowUploadStart"&&(f="flowUploadStarted");t.directive(f,[function(){return{require:"^flowInit",controller:["$scope","$attrs",function(t,i){t.$on("flow::"+u,function(){var u=Array.prototype.slice.call(arguments),o=u.shift(),e;t.$flow===u.shift()&&(e={},n.forEach(r,function(n,t){e[n]=u[t]}),t.$eval(i[f],e)===!1&&o.preventDefault())})}]}}])})}(angular);angular.module("flow.img",["flow.init"]).directive("flowImg",[function(){return{scope:!1,require:"^flowInit",link:function(n,t,i){var r=i.flowImg;n.$watch(r,function(t){if(t){var r=new FileReader;r.readAsDataURL(t.file);r.onload=function(t){n.$apply(function(){i.$set("src",t.target.result)})}}})}}}]);angular.module("flow.transfers",["flow.init"]).directive("flowTransfers",[function(){return{scope:!0,require:"^flowInit",link:function(n){n.transfers=n.$flow.files}}}]);angular.module("flow",["flow.provider","flow.init","flow.events","flow.btn","flow.drop","flow.transfers","flow.img","flow.dragEvents"]);
/*
//# sourceMappingURL=ng-flow-standalone.min.js.map
*/