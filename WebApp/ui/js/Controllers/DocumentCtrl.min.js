angular.module("DeepDev.controllers").controller("DocumentCtrl",["$scope","$rootScope","$http","$window","$location","$animate","$timeout","$routeParams","server","local","authentication","ui",function(n,t,i,r,u,f,e,o,s,h,c,l){var y,rt;n.$on("$viewContentLoaded",function(){c.initialize(k);t.helpTitle="Documents Help";t.hide=!0;t.loading=!0});var k=function(){h.clearData();t.projectId=parseInt(o.projectId.replace(":","")||"-1");t.documentType=o.documentId.replace(":","");t.projectId>=0?s.getEntity({id:t.projectId,ParentId:t.projectId,parentType:t.documentType},p,nt,"projectForDocument"):(console.log("Failed to get projectId from route parameters"),console.log(o),u.path("/dashboard"))},p=function(i){var k,r,u,s,o,c,f,v,l,g;for(h.initialize(i,n,p),a(t.data,1),t.data.Properties.Gantt&&(n.tasks={data:t.data.Properties.Gantt}),t.documentVersion="1.0",t.documentAuthor=t.userName,t.documentTitle=t.data.ParentType,t.documentTime=(new Date).toDateString(),r=0;r<t.data.DocumentTypes.length;r++)if(t.data.DocumentTypes[r].Id==t.documentId){t.documentType=t.data.DocumentTypes[r];break}if(t.data.Children.UseCases)for(r=0;r<t.data.Children.UseCases.length;r++)k=t.data.Children.UseCases[r],w(k);if(t.data.Children.Tasks){for(r=0;r<t.data.Children.Tasks.length;r++){u=t.data.Children.Tasks[r];b(u.Entity);u.openIssues=!1;for(s in u.Children)if(u.Children.hasOwnProperty(s))for(f=0;f<u.Children[s].length;f++)o=u.Children[s][f],d(o.Entity),a(o,5),(o.Entity.Status=="New"||o.Entity.Status=="Accepted"||o.Entity.Status=="InProgress"||o.Entity.Status=="PendingApproval")&&(u.openIssues=!0);c=u.openIssues?u.Entity.Status+"Tasks (Open Issues)":u.Entity.Status+"Tasks";t.data.Children[c]||(t.data.Children[c]=[]);t.data.Children[c].push(u)}t.data.Children.Tasks=[]}if(t.data.hideBlock=!0,t.data.Children.Requirements)for(f=0;f<t.data.Children.Requirements.length;f++)for(v=t.data.Children.Requirements[f],l=0;l<v.Children.UseCases.length;l++)g=v.Children.UseCases[l],w(g);var tt=function(){document.getElementById("contentheader").innerHTML="Content"},nt=function(n,t){var t,e,i,r,o,u,f;for(t||(t=document),e=n.split(","),i=[],r=0;r<e.length;r++)for(o=t.getElementsByTagName(e[r]),u=0;u<o.length;u++)i.push(o[u]);return(f=i[0],!f)?[]:(f.sourceIndex?i.sort(function(n,t){return n.sourceIndex-t.sourceIndex}):f.compareDocumentPosition&&i.sort(function(n,t){return 3-(n.compareDocumentPosition(t)&6)}),i)},y=function(){var r=document.createElement("div"),u,f,t,i;if(r.id="innertoc",u=r.appendChild(document.createElement("span")),u.id="contentheader",u.innerHTML='<h2 class="document">Content<\/h2>',f=r.appendChild(document.createElement("div")),t=nt("h1,h2,h3,h4,h5"),t.length<2)return!1;for(n.headers=[],i=6;i<t.length;i++)if(t[i].offsetParent!==null&&t[i].textContent!="Table of Content"){var e=parseInt(t[i].nodeName.substring(1,2)),o=t[i],s={id:t[i].id,text:o.textContent,depth:e};n.headers.push(s)}return r};t.loading=!1;e(function(){y()},1e3);e(function(){y()},3e3);e(function(){y()},9e3)},w=function(t){var r=h.getSequenceStatus(t),i;for(t.Entity.Status=r.text,t.Entity.color=r.color,t.Entity.hideInProj=!0,i=0;i<t.Methods.length;i++)t.Entity.MethodComments[t.Methods[i].Entity.Id]&&(t.Methods[i].comment=t.Entity.MethodComments[t.Methods[i].Entity.Id]);l.initSequenceDiagram(t.Entity,n);g(t)},b=function(n){var t=h.getTaskStatus(n);n.color=t.color;n.effortColor=t.effortColor;n.hideInProj=!0},d=function(n){var t=h.getIssueStatus(n);n.color=t.color;n.effortColor=t.effortColor;n.hideInProj=!0},a=function(n,t){var i,r,u,f;n.size=t;n.Type=="Method"&&(n.string=h.methodText(n));for(i in n.Children)if(n.Children.hasOwnProperty(i))for(r=0;r<n.Children[i].length;r++)a(n.Children[i][r],t+1);if(n.Trees.Notes)for(u=0;u<n.Trees.Notes.length;u++)v(n.Trees.Notes[u],t+1);if(n.Trees.Tasks)for(f=0;f<n.Trees.Tasks.length;f++)v(n.Trees.Tasks[f],t+1)},v=function(n,t){n.size=t;n.Entity.size=t;n.Type=="Task"&&b(n.Entity);for(var i=0;i<n.Children.length;i++)v(n.Children[i],t+1)},g=function(n){h.updateSequence(n)},nt=function(n){t.loading=!0;console.log("Failed to get action for user in  "+u.path());console.log(n)},ut=function(){u.path("/useCaseEdit/:"+t.milestone.Id+"/:"+t.action.UseCaseId)},tt=function(){console.log("commitParameterSuccess")},it=function(n){var i=!1,t;return n&&(t=n.toLowerCase(),t.length>8&&(t=t.substring(0,8)),i=t=="whatever"),i};n.showItem=function(n){return t.project&&t.project[n]&&!it(t.project[n].Name)};t.getScale=function(n){for(var r=n.length-8,t=1,i=0;i<r;i++)t=t*.9;return t};n.showDeployment=function(){return n.showItem("TargetOS")||n.showItem("DevelopmentLanguage")};n.showGlossary=function(){return n.showItem("Glossaries")};n.tasksForMilestone=function(n,t){var u=t.Milestone.Id,r=[],i;if(t.Tasks)for(i=0;i<t.Tasks.length;i++)t.Tasks[i].Task.ComponentId==n.Component.Id&&r.push(t.Tasks[i]);return r};n.finishItem=function(){console.log(t.action);for(var n=0;n<t.action.Parameters.length;n++)s.updateEntity(t.action.Parameters[n],tt,null,"parameter");t.action.Id>0?s.updateEntity(t.action,y,null,"action"):s.commitEntity(t.action,y,null,"action")};y=function(){console.log("commitActionSuccess")};rt=function(n){var f,i,r;for(console.log(n),f=n.Parameter,t.action.Parameters=t.action.Parameters||[],t.action.Parameters.push(f),i=!1,r=0;r<t.parameterNames.length&&!i;r++)f.Name==t.parameterNames[r]&&(i=!0);for(i||t.parameterNames.push(f.Name),i=!1,r=0;r<t.parameterTypes.length&&!i;r++)f.Type==t.parameterTypes[r]&&(i=!0);i||t.parameterTypes.push(f.Type);console.log("Got parameter in "+u.path());console.log(t.action.Parameters)}}]);
/*
//# sourceMappingURL=DocumentCtrl.min.js.map
*/