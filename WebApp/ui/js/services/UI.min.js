angular.module("DeepDev.services").service("ui",["$http","$q","$rootScope","$location","$window","server","local","rnd","default_definition","post_script_functions",function(n,t,i,r,u,f,e,o,s,h){var c=function(n){n.showWeeks=!0;n.toggleWeeks=function(){n.showWeeks=!n.showWeeks};n.disabled=function(){return!1};n.toggleMin=function(){n.minDate=n.minDate?null:new Date};n.toggleMin();n.open=function(t){t.preventDefault();t.stopPropagation();n.opened=!0};n.dateOptions={"year-format":"'yy'","starting-day":1};n.formats=["longDate","dd-MMMM-yyyy","yyyy/MM/dd","shortDate"];n.format=n.formats[0]},l=function(n,t,i){n.steps=t;n.step=0;n.isFirstStep=function(){return n.step===0};n.isLastStep=function(){return n.step===n.steps.length-1};n.isCurrentStep=function(t){return n.step===t};n.wizardClass=function(t){return n.step===t?"active-step":n.step>t?"completed-step":""};n.setCurrentStep=function(t){console.log("Setting step "+t);n.step=t};n.getCurrentStep=function(){return n.steps[n.step]};n.getNextLabel=function(){return n.isLastStep()?"Submit":"Next"};n.handlePrevious=function(){n.step-=n.isFirstStep()?0:1};n.handleNext=function(){n.isLastStep()?n.wizardDone(i):n.step+=1}},a=function(n,t){(t||(t=n),n)&&(n.margin=10,n.user_width=80,n.user_height=50,n.note_width=160,n.note_height=30,n.height=0,n.width=0,n.lines=[],n.users=[],n.arrows=[],n.notes=[],n.wantHandDraw=!1,n.paperSizes={A0:{width:2384,height:3370},A1:{width:1684,height:2384},A2:{width:1191,height:1684},A3:{width:842,height:1191},A4:{width:595,height:842}},n.pageSizes=Object.keys(n.paperSizes),n.pageSize="A4",n.definition=s,n==t?t.$watch("definition",function(){n.draw()}):t.$watch("scope.definition",function(){n.draw()}),n.log=function(n){return console&&console.log&&console.log(n),n},n.Math=Math,n.download=function(n){u.location.href="data:application/x-download;charset=utf-8,"+encodeURIComponent(n)},n.draw=function(){var e,r,a,u,t,i;n.height=n.user_height+n.margin;n.width=-1;n.users=[];n.lines=[];n.arrows=[];n.notes=[];e=n.definition.split("\n");for(t in e)if(r=e[t].trim(),/^([^-]*(-+[^-]+)*)(-->|->)(.*):(.*)$/.exec(r)!=null){var v=RegExp.$1.trim(),y=RegExp.$3.trim(),p=RegExp.$4.trim(),o=RegExp.$5.trim(),s=n.getUser(v),l=n.getUser(p);n.arrows.push({x:s.x+n.user_width/2,y:n.height+n.user_height/2,length:Math.abs(s.x-l.x),direction:l.x>s.x?1:-1,text:o,dashed:y=="-->"});n.height+=50}else if(/^participant:(.*) as (.*)$/.exec(r)!=null)u=RegExp.$1.trim(),a=RegExp.$2.trim(),n.getUser(u,a);else if(/^participant:(.*)$/.exec(r)!=null)u=RegExp.$1.trim(),n.getUser(u);else if(/^note (left of|right of|over) (.*):(.*)$/.exec(r)!=null){var h=RegExp.$1.trim(),u=RegExp.$2.trim(),o=RegExp.$3.trim(),i=n.getUser(u),f,c=o.length*2;h=="right of"?f=n.margin:h=="left of"?f=-n.margin-c:h=="over"&&(f=-c/2);n.notes.push({x:i.x+c+f,y:n.height,text:o});n.height+=n.note_height}n.height+=n.margin+n.user_height;for(t in n.users)i=n.users[t],n.lines.push({x:i.x+n.user_width/2,y:n.user_height,dx:0,dy:n.height-2*n.user_height});for(t in n.users)i=n.users[t],n.users.push({x:i.x,y:n.height-n.user_height-2,name:i.name,first:t==0})},n.getUser=function(t,i){for(var r,u=0;u<n.users.length;u++)if(r=n.users[u],r.name==t||r.alias==t)return r;return n.width==0?n.width=0:n.width+=250,r={x:Math.max(1,n.users.length*250+1),y:1,name:t,alias:i,first:n.users.length==0},n.users.push(r),r},n.byHand=function(t,i,r,u){var h=t+","+i,f,e,s;if(n.wantHandDraw){o.reset();f=Math.ceil(Math.sqrt((t-r)*(t-r)+(i-u)*(i-u))/10);e=2;function c(n){return n+o.next()*e-e/2}var l=t,a=i,v=(r-t)/f,y=(u-i)/f;for(s=1;s<f;s++)l+=v,a+=y,h+=" "+c(l)+","+c(a)}return h+" "+r+","+u},n.rectByHand=function(t,i,r,u){return[n.byHand(t,i,r,i),n.byHand(r,i,r,u),n.byHand(r,u,t,u),n.byHand(t,u,t,i)].join(" ")},n.print=function(){var u=n.paperSizes[n.pageSize],e=(u.width-2*n.margin)/n.width,o=(u.height-2*n.margin)/n.height,a=!1,l=Math.min(e,o),i,s,f,r,t,c;e<o&&(a=!0,e=(u.height-2*n.margin)/n.width,o=(u.width-2*n.margin)/n.height,l=Math.min(e,o));i="%!PS\n/PageSize "+n.pageSize+"\n"+(a?u.width+" 0 translate 90 rotate":"")+"\n"+n.margin+" "+n.margin+" translate\n"+l+" "+l+" scale\n/UW "+n.user_width+" def %user_width\n/UH "+n.user_height+" def %user_height\n/NW "+n.note_width+" def %note_width\n/NH "+n.note_height+" def %note_height\n/wantHandDraw "+(n.wantHandDraw?1:0)+" def\n"+h;for(t in n.users)s=n.users[t],i+="("+s.name+") "+s.x+" "+(n.height-s.y)+" USER\n";for(t in n.lines)f=n.lines[t],i+=f.x+" "+(n.height-f.y)+" "+f.dx+" "+-f.dy+" LINE\n";for(t in n.arrows)r=n.arrows[t],i+="("+r.text+") "+r.x+" "+(n.height-r.y)+" "+r.direction+" "+r.length+" "+(r.dashed?"DASHED":"")+"ARROW\n";for(t in n.notes)c=n.notes[t],i+="("+c.text+") "+c.x+" "+(n.height-c.y)+" NOTE\n";i+="showpage\n";n.download(i)})};return{configureDatetimepicker:function(n){c(n)},configureWizard:function(n,t,i){l(n,t,i)},initSequenceDiagram:function(n,t){a(n,t)}}}]).service("rnd",function(){var n=123;return{reset:function(){n=123},next:function(){return n=(n*134775813+1)%4294967296,n/4294967296}}}).value("default_definition","participant: Alice as A\nparticipant: B\n\nUser->A: DoWork\nA-->B: <<createRequest>>\nnote right of B: what should I do?\nB-->C: DoWork\nnote over C: processing...\nC->B: WorkDone\nnote left of B: hmm.. it was fast\nB->A: RequestCreated\nA->User: Done").value("post_script_functions","/SEED 120 def\n/MOD {\n% a mod b == a - floor(a / b) * b\n2 copy div floor mul neg add\n} def\n/RND { % returns a float number between -x and x\n/SEED SEED 13 mul 1 add 256 mod def\nneg dup neg\n%-x x\nSEED 256 div\n%-x x rnd\nmul 2 mul add\n} def\n/L {%dx dy x0 y0\n/SEED 120 def\nmoveto LL\n} def\n/LL {\n%dx dy\nmatrix currentmatrix %saves current transformation matrix\n3 1 roll\n%CTM dx dy\ncurrentpoint translate\n%compute how many segments we want to use\n2 copy abs exch abs add 10 div ceiling cvi\n%CTM dx dy count\n3 1 roll\n%CTM count dx dy\n1 index 3 index div 1 index 4 index div\n%CTM count dx dy stepx stepy\n0 0\n%CTM count dx dy stepx stepy x y\n7 -1 roll\n%CTM dx dy stepx stepy x y count\n-1 add {\n2 index add exch %y += stepy\n3 index add exch %x += stepx\n2 copy 1 RND add exch 1 RND add exch lineto\n} repeat\n%add the last segment without any randomization\n2 index add exch\n3 index add exch\nlineto\npop pop pop pop\nsetmatrix %restore CTM\n} def\n0 wantHandDraw eq {\n/LL {rlineto} def\n} if\n/ARROW { % text x y direction length\n/Times-Roman findfont 15 scalefont setfont\n2 setlinewidth 1 setlinejoin 1 setlinecap\nnewpath\n% text x y direction length\n2 copy mul 0\n% text x y direction length dx 0\n5 index 5 index L\n% text x y direction length\ncurrentpoint stroke moveto\n[] 0 setdash\n%draw the arrow head\n1 index\ndup -10 mul -10 rmoveto\ndup 10 mul 10 LL\n-10 mul 10 LL\nstroke\n% text x y direction length\n% fill the background of the text with white\n3 index 3 index moveto %move to x,y\n% text x y direction length\n2 copy\n% text x y direction length direction length\nmul 2 div 2 rmoveto %move to the center of the arrow\n% text x y direction length\n4 index stringwidth pop 2 div neg 0 rmoveto %move to the left side of the text\n4 index stringwidth pop 0 rlineto\n0 17 rlineto\n4 index stringwidth pop neg 0 rlineto\nclosepath\n1 setgray\nfill\nstroke\n% text x y direction length\n% draw the text\n0 setgray\n3 index 3 index moveto\nmul 2 div 6 rmoveto\npop pop\ndup stringwidth pop 2 div neg 0 rmoveto\nshow\nstroke\n} def\n/DASHEDARROW { % text x y direction length\n[9 4] 0 setdash\nARROW\n} def\n/RECT {\n%x y width height\n1 index 0 5 index 5 index L %line: width 0 x y\n0 1 index LL %rlineto: 0 height\n1 index neg 0 LL %rlineto: -width 0\n0 1 index neg LL %rlineto: 0 -height\npop pop pop pop\n} def\n/FILLRECT {\n%fillgray bordergray x y width height\n% draw the gray background\nnewpath 4 copy RECT closepath\n5 index setgray\nfill\n% draw the border of the box\n%fillgray bordergray x y width height\nnewpath RECT closepath\nsetgray stroke pop\n} def\n/USER { %name x y\n/Times-Roman findfont 15 scalefont setfont\n2 setlinewidth\n0.84375 0 3 index 3 index UW UH neg FILLRECT\n% draw the text in the center of the box\nnewpath\nmoveto\nUW 2 div UH neg 2 div rmoveto % center of the box\n0 -5 rmoveto % lower the text a little bit, so it will be in the center of the box visually\n0 setgray\ndup stringwidth pop 2 div neg 0 rmoveto\nshow\nstroke\n} def\n/LINE { %x y dx dy\n2 setlinewidth\n1 setlinejoin\n1 setlinecap\nnewpath\n4 2 roll L\nstroke\n} def\n/NOTE { %text x y\n/Times-Roman findfont 10 scalefont setfont\n1 setlinewidth\n% draw the filled rect\n1 0 3 index 3 index NW NH neg FILLRECT\n% draw the text in the center of the box\nnewpath\nmoveto\nNW 2 div NH neg 2 div rmoveto % center of the box\n0 -3 rmoveto % lower the text a little bit, so it will be in the center of the box visually\n0 setgray\ndup stringwidth pop 2 div neg 0 rmoveto\nshow\nstroke\n} def\n").service("ScrollTo",["$window",function(n){this.idOrName=function(t,i,r){var f=n.document,u,e;t||n.scrollTo(0,0);r===undefined&&(r=!0);u=f.getElementById(t);u||(u=f.getElementsByName(t),u=u&&u.length?u[0]:null);u&&(r&&u.focus(),i?(e=$(u).offset().top-i,window.scrollTo(0,e)):u.scrollIntoView())}}]);
/*
//# sourceMappingURL=UI.min.js.map
*/